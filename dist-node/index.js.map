{"version":3,"file":"index.js","sources":["../dist-src/rewrite-imports.js","../dist-src/util.js","../dist-src/commands/build-util.js","../dist-src/commands/esbuildPlugin.js","../dist-src/resolve-remote.js","../dist-src/rollup-plugin-css.js","../dist-src/rollup-plugin-entrypoint-alias.js","../dist-src/rollup-plugin-catch-unresolved.js","../dist-src/rollup-plugin-wrap-install-targets.js","../dist-src/rollup-plugin-remote-cdn.js","../dist-src/rollup-plugin-stats.js","../dist-src/scan-imports.js","../dist-src/stats-formatter.js","../dist-src/commands/install.js","../dist-src/commands/paint.js","../dist-src/commands/src-file-extension-mapping.js","../dist-src/commands/build.js","../dist-src/hmr-server-engine.js","../dist-src/commands/dev.js","../dist-src/commands/add-rm.js","../dist-src/config.js","../dist-src/index.js"],"sourcesContent":["const { parse } = require('es-module-lexer');\nfunction spliceString(source, withSlice, start, end) {\n    return source.slice(0, start) + (withSlice || '') + source.slice(end);\n}\nexport async function scanCodeImportsExports(code) {\n    const [imports] = await parse(code);\n    return imports.filter((imp) => {\n        //imp.d = -2 = import.meta.url = we can skip this for now\n        if (imp.d === -2) {\n            return false;\n        }\n        // imp.d > -1 === dynamic import\n        if (imp.d > -1) {\n            const importStatement = code.substring(imp.s, imp.e);\n            const importSpecifierMatch = importStatement.match(/^\\s*['\"](.*)['\"]\\s*$/m);\n            return !!importSpecifierMatch;\n        }\n        return true;\n    });\n}\nexport async function transformEsmImports(_code, replaceImport) {\n    const imports = await scanCodeImportsExports(_code);\n    let rewrittenCode = _code;\n    for (const imp of imports.reverse()) {\n        let spec = rewrittenCode.substring(imp.s, imp.e);\n        if (imp.d > -1) {\n            const importSpecifierMatch = spec.match(/^\\s*['\"](.*)['\"]\\s*$/m);\n            spec = importSpecifierMatch[1];\n        }\n        let rewrittenImport = replaceImport(spec);\n        if (imp.d > -1) {\n            rewrittenImport = JSON.stringify(rewrittenImport);\n        }\n        rewrittenCode = spliceString(rewrittenCode, rewrittenImport, imp.s, imp.e);\n    }\n    return rewrittenCode;\n}\n","import rimraf from 'rimraf';\nimport cacache from 'cacache';\nimport globalCacheDir from 'cachedir';\nimport etag from 'etag';\nimport execa from 'execa';\nimport projectCacheDir from 'find-cache-dir';\nimport findUp from 'find-up';\nimport fs from 'fs';\nimport got from 'got';\nimport open from 'open';\nimport path from 'path';\nimport mkdirp from 'mkdirp';\nexport const PIKA_CDN = `https://cdn.pika.dev`;\nexport const GLOBAL_CACHE_DIR = globalCacheDir('snowpack');\nexport const RESOURCE_CACHE = path.join(GLOBAL_CACHE_DIR, 'pkg-cache-1.4');\nexport const BUILD_CACHE = path.join(GLOBAL_CACHE_DIR, 'build-cache-1.4');\nexport const PROJECT_CACHE_DIR = projectCacheDir({ name: 'snowpack' });\nexport const DEV_DEPENDENCIES_DIR = path.join(PROJECT_CACHE_DIR, 'dev');\nexport const BUILD_DEPENDENCIES_DIR = path.join(PROJECT_CACHE_DIR, 'build');\nconst LOCKFILE_HASH_FILE = '.hash';\nexport const HAS_CDN_HASH_REGEX = /\\-[a-zA-Z0-9]{16,}/;\nexport function isYarn(cwd) {\n    return fs.existsSync(path.join(cwd, 'yarn.lock'));\n}\nexport async function readLockfile(cwd) {\n    try {\n        var lockfileContents = fs.readFileSync(path.join(cwd, 'snowpack.lock.json'), {\n            encoding: 'utf8',\n        });\n    }\n    catch (err) {\n        // no lockfile found, ignore and continue\n        return null;\n    }\n    // If this fails, we actually do want to alert the user by throwing\n    return JSON.parse(lockfileContents);\n}\nexport async function writeLockfile(loc, importMap) {\n    const sortedImportMap = { imports: {} };\n    for (const key of Object.keys(importMap.imports).sort()) {\n        sortedImportMap.imports[key] = importMap.imports[key];\n    }\n    fs.writeFileSync(loc, JSON.stringify(sortedImportMap, undefined, 2), { encoding: 'utf8' });\n}\nexport function fetchCDNResource(resourceUrl, responseType) {\n    if (!resourceUrl.startsWith(PIKA_CDN)) {\n        resourceUrl = PIKA_CDN + resourceUrl;\n    }\n    // @ts-ignore - TS doesn't like responseType being unknown amount three options\n    return got(resourceUrl, {\n        responseType: responseType,\n        headers: { 'user-agent': `snowpack/v1.4 (https://snowpack.dev)` },\n        throwHttpErrors: false,\n    });\n}\nexport function isTruthy(item) {\n    return Boolean(item);\n}\n/**\n * Given a package name, look for that package's package.json manifest.\n * Return both the manifest location (if believed to exist) and the\n * manifest itself (if found).\n *\n * NOTE: You used to be able to require() a package.json file directly,\n * but now with export map support in Node v13 that's no longer possible.\n */\nexport function resolveDependencyManifest(dep, cwd) {\n    // Attempt #1: Resolve the dependency manifest normally. This works for most\n    // packages, but fails when the package defines an export map that doesn't\n    // include a package.json. If we detect that to be the reason for failure,\n    // move on to our custom implementation.\n    try {\n        const depManifest = require.resolve(`${dep}/package.json`, { paths: [cwd] });\n        return [depManifest, require(depManifest)];\n    }\n    catch (err) {\n        // if its an export map issue, move on to our manual resolver.\n        if (err.code !== 'ERR_PACKAGE_PATH_NOT_EXPORTED') {\n            return [null, null];\n        }\n    }\n    // Attempt #2: Resolve the dependency manifest manually. This involves resolving\n    // the dep itself to find the entrypoint file, and then haphazardly replacing the\n    // file path within the package with a \"./package.json\" instead. It's not as\n    // thorough as Attempt #1, but it should work well until export maps become more\n    // established & move out of experimental mode.\n    let result = [null, null];\n    try {\n        const fullPath = require.resolve(dep, { paths: [cwd] });\n        // Strip everything after the package name to get the package root path\n        // NOTE: This find-replace is very gross, replace with something like upath.\n        const searchPath = `${path.sep}node_modules${path.sep}${dep.replace('/', path.sep)}`;\n        const indexOfSearch = fullPath.lastIndexOf(searchPath);\n        if (indexOfSearch >= 0) {\n            const manifestPath = fullPath.substring(0, indexOfSearch + searchPath.length + 1) + 'package.json';\n            result[0] = manifestPath;\n            const manifestStr = fs.readFileSync(manifestPath, { encoding: 'utf8' });\n            result[1] = JSON.parse(manifestStr);\n        }\n    }\n    catch (err) {\n        // ignore\n    }\n    finally {\n        return result;\n    }\n}\n/**\n * If Rollup erred parsing a particular file, show suggestions based on its\n * file extension (note: lowercase is fine).\n */\nexport const MISSING_PLUGIN_SUGGESTIONS = {\n    '.svelte': 'Try installing rollup-plugin-svelte and adding it to Snowpack (https://www.snowpack.dev/#custom-rollup-plugins)',\n    '.vue': 'Try installing rollup-plugin-vue and adding it to Snowpack (https://www.snowpack.dev/#custom-rollup-plugins)',\n};\nconst appNames = {\n    win32: {\n        brave: 'brave',\n        chrome: 'chrome',\n    },\n    darwin: {\n        brave: 'Brave Browser',\n        chrome: 'Google Chrome',\n    },\n    linux: {\n        brave: 'brave',\n        chrome: 'google-chrome',\n    },\n};\nexport async function openInBrowser(protocol, port, browser) {\n    const url = `${protocol}//localhost:${port}`;\n    browser = /chrome/i.test(browser)\n        ? appNames[process.platform]['chrome']\n        : /brave/i.test(browser)\n            ? appNames[process.platform]['brave']\n            : browser;\n    if (process.platform === 'darwin' && /chrome|default/i.test(browser)) {\n        // If we're on macOS, and we haven't requested a specific browser,\n        // we can try opening Chrome with AppleScript. This lets us reuse an\n        // existing tab when possible instead of creating a new one.\n        try {\n            await execa.command('ps cax | grep \"Google Chrome\"', {\n                shell: true,\n            });\n            await execa('osascript ../assets/openChrome.applescript \"' + encodeURI(url) + '\"', {\n                cwd: __dirname,\n                stdio: 'ignore',\n                shell: true,\n            });\n            return true;\n        }\n        catch (err) {\n            // If macOS auto-reuse doesn't work, just open normally, using default browser.\n            open(url);\n        }\n    }\n    else {\n        browser === 'default' ? open(url) : open(url, { app: browser });\n    }\n}\nexport async function checkLockfileHash(dir) {\n    const lockfileLoc = await findUp(['package-lock.json', 'yarn.lock']);\n    if (!lockfileLoc) {\n        return true;\n    }\n    const hashLoc = path.join(dir, LOCKFILE_HASH_FILE);\n    const newLockHash = etag(await fs.promises.readFile(lockfileLoc, 'utf-8'));\n    const oldLockHash = await fs.promises.readFile(hashLoc, 'utf-8').catch(() => '');\n    return newLockHash === oldLockHash;\n}\nexport async function updateLockfileHash(dir) {\n    const lockfileLoc = await findUp(['package-lock.json', 'yarn.lock']);\n    if (!lockfileLoc) {\n        return;\n    }\n    const hashLoc = path.join(dir, LOCKFILE_HASH_FILE);\n    const newLockHash = etag(await fs.promises.readFile(lockfileLoc));\n    await mkdirp(path.dirname(hashLoc));\n    await fs.promises.writeFile(hashLoc, newLockHash);\n}\nexport async function clearCache() {\n    return Promise.all([\n        cacache.rm.all(RESOURCE_CACHE),\n        cacache.rm.all(BUILD_CACHE),\n        rimraf.sync(PROJECT_CACHE_DIR),\n    ]);\n}\n/**\n * Given an import string and a list of scripts, return the mount script that matches the import.\n *\n * `mount ./src --to /_dist_` and `mount src --to /_dist_` match `src/components/Button`\n * `mount src --to /_dist_` does not match `package/components/Button`\n */\nexport function findMatchingMountScript(scripts, spec) {\n    // Only match bare module specifiers. relative and absolute imports should not match\n    if (spec.startsWith('./') ||\n        spec.startsWith('../') ||\n        spec.startsWith('/') ||\n        spec.startsWith('http://') ||\n        spec.startsWith('https://')) {\n        return null;\n    }\n    return scripts\n        .filter((script) => script.type === 'mount')\n        .find(({ args }) => spec.startsWith(args.fromDisk));\n}\n","import execa from 'execa';\nimport { statSync } from 'fs';\nimport npmRunPath from 'npm-run-path';\nimport path from 'path';\nconst IS_PREACT = /from\\s+['\"]preact['\"]/;\nexport function checkIsPreact(filePath, contents) {\n    return filePath.endsWith('.jsx') && IS_PREACT.test(contents);\n}\nexport function isDirectoryImport(fileLoc, spec) {\n    const importedFileOnDisk = path.resolve(path.dirname(fileLoc), spec);\n    try {\n        const stat = statSync(importedFileOnDisk);\n        return stat.isDirectory();\n    }\n    catch (err) {\n        // file doesn't exist, that's fine\n    }\n    return false;\n}\nexport function wrapImportMeta({ code, hmr, env, config: { buildOptions }, }) {\n    if (!code.includes('import.meta')) {\n        return code;\n    }\n    return ((hmr\n        ? `import * as  __SNOWPACK_HMR__ from '/${buildOptions.metaDir}/hmr.js';\\nimport.meta.hot = __SNOWPACK_HMR__.createHotContext(import.meta.url);\\n`\n        : ``) +\n        (env\n            ? `import __SNOWPACK_ENV__ from '/${buildOptions.metaDir}/env.js';\\nimport.meta.env = __SNOWPACK_ENV__;\\n`\n            : ``) +\n        '\\n' +\n        code);\n}\nlet _cssModuleLoader;\nexport async function wrapCssModuleResponse({ url, code, ext, hasHmr = false, config: { buildOptions }, }) {\n    _cssModuleLoader = _cssModuleLoader || new (require('css-modules-loader-core'))();\n    const { injectableSource, exportTokens } = await _cssModuleLoader.load(code, url, undefined, () => {\n        throw new Error('Imports in CSS Modules are not yet supported.');\n    });\n    return `${hasHmr\n        ? `\nimport * as __SNOWPACK_HMR_API__ from '/${buildOptions.metaDir}/hmr.js';\nimport.meta.hot = __SNOWPACK_HMR_API__.createHotContext(import.meta.url);\nimport.meta.hot.accept(({module}) => {\n  code = module.code;\n  json = module.default;\n});\nimport.meta.hot.dispose(() => {\n  document.head.removeChild(styleEl);\n});\\n`\n        : ``}\nexport let code = ${JSON.stringify(injectableSource)};\nlet json = ${JSON.stringify(exportTokens)};\nexport default json;\n\nconst styleEl = document.createElement(\"style\");\nconst codeEl = document.createTextNode(code);\nstyleEl.type = 'text/css';\n\nstyleEl.appendChild(codeEl);\ndocument.head.appendChild(styleEl);`;\n}\nexport function wrapHtmlResponse({ code, hasHmr = false, buildOptions, }) {\n    // replace %PUBLIC_URL% in HTML files (along with surrounding slashes, if any)\n    code = code.replace(/\\/?%PUBLIC_URL%\\/?/g, '/');\n    if (hasHmr) {\n        code += `<script type=\"module\" src=\"/${buildOptions.metaDir}/hmr.js\"></script>`;\n    }\n    return code;\n}\nexport function wrapEsmProxyResponse({ url, code, ext, hasHmr = false, config: { buildOptions }, }) {\n    if (ext === '.json') {\n        return `${hasHmr\n            ? `\n    import * as __SNOWPACK_HMR_API__ from '/${buildOptions.metaDir}/hmr.js';\n    import.meta.hot = __SNOWPACK_HMR_API__.createHotContext(import.meta.url);\n    import.meta.hot.accept(({module}) => {\n      json = module.default;\n    });`\n            : ''}\nlet json = ${JSON.stringify(JSON.parse(code))};\nexport default json;`;\n    }\n    if (ext === '.css') {\n        return `${hasHmr\n            ? `\nimport * as __SNOWPACK_HMR_API__ from '/${buildOptions.metaDir}/hmr.js';\nimport.meta.hot = __SNOWPACK_HMR_API__.createHotContext(import.meta.url);\nimport.meta.hot.accept();\nimport.meta.hot.dispose(() => {\n  document.head.removeChild(styleEl);\n});\\n`\n            : ''}\nconst code = ${JSON.stringify(code)};\n\nconst styleEl = document.createElement(\"style\");\nconst codeEl = document.createTextNode(code);\nstyleEl.type = 'text/css';\n\nstyleEl.appendChild(codeEl);\ndocument.head.appendChild(styleEl);`;\n    }\n    return `export default ${JSON.stringify(url)};`;\n}\nexport function getFileBuilderForWorker(cwd, selectedWorker, messageBus) {\n    const { id, type, cmd, plugin } = selectedWorker;\n    if (type !== 'build') {\n        throw new Error(`scripts[${id}] is not a build script.`);\n    }\n    if (plugin?.build) {\n        const buildFn = plugin.build;\n        return async (args) => {\n            try {\n                const result = await buildFn(args);\n                return result;\n            }\n            catch (err) {\n                messageBus.emit('WORKER_MSG', { id, level: 'error', msg: err.message });\n                messageBus.emit('WORKER_UPDATE', { id, state: ['ERROR', 'red'] });\n                return null;\n            }\n        };\n    }\n    return async ({ contents, filePath }) => {\n        let cmdWithFile = cmd.replace('$FILE', filePath);\n        try {\n            const { stdout, stderr } = await execa.command(cmdWithFile, {\n                env: npmRunPath.env(),\n                extendEnv: true,\n                shell: true,\n                input: contents,\n                cwd,\n            });\n            if (stderr) {\n                messageBus.emit('WORKER_MSG', { id, level: 'warn', msg: `${filePath}\\n${stderr}` });\n            }\n            return { result: stdout };\n        }\n        catch (err) {\n            messageBus.emit('WORKER_MSG', { id, level: 'error', msg: `${filePath}\\n${err.stderr}` });\n            messageBus.emit('WORKER_UPDATE', { id, state: ['ERROR', 'red'] });\n            return null;\n        }\n    };\n}\nconst PUBLIC_ENV_REGEX = /^SNOWPACK_PUBLIC_/;\nexport function generateEnvModule(mode) {\n    const envObject = { ...process.env };\n    for (const env of Object.keys(envObject)) {\n        if (!PUBLIC_ENV_REGEX.test(env)) {\n            delete envObject[env];\n        }\n    }\n    envObject.MODE = mode;\n    envObject.NODE_ENV = mode;\n    return `export default ${JSON.stringify(envObject)};`;\n}\n","import { startService } from 'esbuild';\nimport path from 'path';\nimport { checkIsPreact } from './build-util';\nimport chalk from 'chalk';\nlet esbuildService = null;\nexport function esbuildPlugin() {\n    return {\n        async build({ contents, filePath }) {\n            esbuildService = esbuildService || (await startService());\n            const isPreact = checkIsPreact(filePath, contents);\n            const { js, warnings } = await esbuildService.transform(contents, {\n                loader: path.extname(filePath).substr(1),\n                jsxFactory: isPreact ? 'h' : undefined,\n                jsxFragment: isPreact ? 'Fragment' : undefined,\n            });\n            for (const warning of warnings) {\n                console.error(chalk.bold('! ') + filePath);\n                console.error('  ' + warning.text);\n            }\n            return { result: js || '' };\n        },\n    };\n}\nexport function stopEsbuild() {\n    esbuildService && esbuildService.stop();\n}\n","import cacache from 'cacache';\nimport PQueue from 'p-queue';\nimport chalk from 'chalk';\nimport validatePackageName from 'validate-npm-package-name';\nimport { fetchCDNResource, PIKA_CDN, RESOURCE_CACHE } from './util.js';\n/**\n * Given an install specifier, attempt to resolve it from the CDN.\n * If no lockfile exists or if the entry is not found in the lockfile, attempt to resolve\n * it from the CDN directly. Otherwise, use the URL found in the lockfile and attempt to\n * check the local cache first.\n *\n * All resolved URLs are populated into the local cache, where our internal Rollup engine\n * will load them from when it installs your dependencies to disk.\n */\nasync function resolveDependency(installSpecifier, packageSemver, lockfile, canRetry = true) {\n    // Right now, the CDN is only for top-level JS packages. The CDN doesn't support CSS,\n    // non-JS assets, and has limited support for deep package imports. Snowpack\n    // will automatically fall-back any failed/not-found assets from local\n    // node_modules/ instead.\n    if (!validatePackageName(installSpecifier).validForNewPackages) {\n        return null;\n    }\n    // Grab the installUrl from our lockfile if it exists, otherwise resolve it yourself.\n    let installUrl;\n    let installUrlType;\n    if (lockfile && lockfile.imports[installSpecifier]) {\n        installUrl = lockfile.imports[installSpecifier];\n        installUrlType = 'pin';\n    }\n    else {\n        if (packageSemver === 'latest') {\n            console.warn(`warn(${installSpecifier}): Not found in \"dependencies\". Using latest package version...`);\n        }\n        if (packageSemver.startsWith('npm:@reactesm') || packageSemver.startsWith('npm:@pika/react')) {\n            throw new Error(`React workaround packages no longer needed! Revert to the official React & React-DOM packages.`);\n        }\n        if (packageSemver.includes(' ') || packageSemver.includes(':')) {\n            console.warn(`warn(${installSpecifier}): Can't fetch complex semver \"${packageSemver}\" from remote CDN.`);\n            return null;\n        }\n        installUrlType = 'lookup';\n        installUrl = `${PIKA_CDN}/${installSpecifier}@${packageSemver}`;\n    }\n    // Hashed CDN urls never change, so its safe to grab them directly from the local cache\n    // without a network request.\n    if (installUrlType === 'pin') {\n        const cachedResult = await cacache.get.info(RESOURCE_CACHE, installUrl).catch(() => null);\n        if (cachedResult) {\n            if (cachedResult.metadata) {\n                const { pinnedUrl } = cachedResult.metadata;\n                return pinnedUrl;\n            }\n        }\n    }\n    // Otherwise, resolve from the CDN remotely.\n    const { statusCode, headers, body } = await fetchCDNResource(installUrl);\n    if (statusCode !== 200) {\n        console.warn(`Failed to resolve [${statusCode}]: ${installUrl} (${body})`);\n        console.warn(`Falling back to local copy...`);\n        return null;\n    }\n    let importUrlPath = headers['x-import-url'];\n    let pinnedUrlPath = headers['x-pinned-url'];\n    const buildStatus = headers['x-import-status'];\n    const typesUrlPath = headers['x-typescript-types'];\n    const typesUrl = typesUrlPath && `${PIKA_CDN}${typesUrlPath}`;\n    if (installUrlType === 'pin') {\n        const pinnedUrl = installUrl;\n        await cacache.put(RESOURCE_CACHE, pinnedUrl, body, {\n            metadata: { pinnedUrl, typesUrl },\n        });\n        return pinnedUrl;\n    }\n    if (pinnedUrlPath) {\n        const pinnedUrl = `${PIKA_CDN}${pinnedUrlPath}`;\n        await cacache.put(RESOURCE_CACHE, pinnedUrl, body, {\n            metadata: { pinnedUrl, typesUrl },\n        });\n        return pinnedUrl;\n    }\n    if (buildStatus === 'SUCCESS') {\n        console.warn(`Failed to lookup [${statusCode}]: ${installUrl}`);\n        console.warn(`Falling back to local copy...`);\n        return null;\n    }\n    if (!canRetry || buildStatus === 'FAIL') {\n        console.warn(`Failed to build: ${installSpecifier}@${packageSemver}`);\n        console.warn(`Falling back to local copy...`);\n        return null;\n    }\n    console.log(chalk.cyan(`Building ${installSpecifier}@${packageSemver}... (This takes a moment, but will be cached for future use)`));\n    if (!importUrlPath) {\n        throw new Error('X-Import-URL header expected, but none received.');\n    }\n    const { statusCode: lookupStatusCode } = await fetchCDNResource(importUrlPath);\n    if (lookupStatusCode !== 200) {\n        throw new Error(`Unexpected response [${lookupStatusCode}]: ${PIKA_CDN}${importUrlPath}`);\n    }\n    return resolveDependency(installSpecifier, packageSemver, lockfile, false);\n}\nexport async function resolveTargetsFromRemoteCDN(lockfile, pkgManifest, config) {\n    const downloadQueue = new PQueue({ concurrency: 16 });\n    const newLockfile = { imports: {} };\n    let resolutionError;\n    for (const [installSpecifier, installSemver] of Object.entries(config.webDependencies)) {\n        downloadQueue.add(async () => {\n            try {\n                const resolvedUrl = await resolveDependency(installSpecifier, installSemver, lockfile);\n                if (resolvedUrl) {\n                    newLockfile.imports[installSpecifier] = resolvedUrl;\n                }\n            }\n            catch (err) {\n                resolutionError = resolutionError || err;\n            }\n        });\n    }\n    await downloadQueue.onIdle();\n    if (resolutionError) {\n        throw resolutionError;\n    }\n    return newLockfile;\n}\n","import { promises as fs } from 'fs';\nfunction getInjectorCode(name, code) {\n    return `\n/** SNOWPACK INJECT STYLE: ${name} */\nfunction __snowpack__injectStyle(css) {\n  const headEl = document.head || document.getElementsByTagName('head')[0];\n  const styleEl = document.createElement('style');\n  styleEl.type = 'text/css';\n  if (styleEl.styleSheet) {\n    styleEl.styleSheet.cssText = css;\n  } else {\n    styleEl.appendChild(document.createTextNode(css));\n  }\n  headEl.appendChild(styleEl);\n}\n__snowpack__injectStyle(${JSON.stringify(code)});\\n`;\n}\n/**\n * rollup-plugin-css\n *\n * Support installing any imported CSS into your dependencies. This isn't strictly valid\n * ESM code, but it is popular in the npm ecosystem & web development ecosystems. It also\n * solves a problem that is difficult to solve otherwise (referencing CSS from JS) so for\n * those reasons we have added default support for importing CSS into Snowpack v2.\n */\nexport function rollupPluginCss() {\n    return {\n        name: 'snowpack:rollup-plugin-css',\n        resolveId(source, importer) {\n            if (!source.endsWith('.css')) {\n                return null;\n            }\n            return this.resolve(source, importer, { skipSelf: true }).then((resolved) => {\n                return resolved || null;\n            });\n        },\n        async load(id) {\n            if (!id.endsWith('.css')) {\n                return null;\n            }\n            const code = await fs.readFile(id, { encoding: 'utf8' });\n            const humanReadableName = id.replace(/.*node_modules[\\/\\\\]/, '').replace(/[\\/\\\\]/g, '/');\n            return getInjectorCode(humanReadableName, code);\n        },\n    };\n}\n","import path from 'path';\nimport { resolveDependencyManifest } from './util';\nconst IS_DEEP_PACKAGE_IMPORT = /^(@[\\w-]+\\/)?([\\w-]+)\\/(.*)/;\n/**\n * rollup-plugin-entrypoint-alias\n *\n * Aliases any deep imports from a package to the package name, so that\n * chunking can happen more accurately.\n *\n * Example: lit-element imports from both 'lit-html' & 'lit-html/lit-html.js'.\n * Even though both eventually resolve to the same place, without this plugin\n * we lose the ability to mark \"lit-html\" as an external package.\n */\nexport function rollupPluginEntrypointAlias({ cwd }) {\n    return {\n        name: 'snowpack:rollup-plugin-entrypoint-alias',\n        resolveId(source, importer) {\n            if (!IS_DEEP_PACKAGE_IMPORT.test(source)) {\n                return null;\n            }\n            const [, packageScope, packageName] = source.match(IS_DEEP_PACKAGE_IMPORT);\n            const packageFullName = packageScope ? `${packageScope}${packageName}` : packageName;\n            let manifest;\n            try {\n                const [, _manifest] = resolveDependencyManifest(packageFullName, cwd);\n                manifest = _manifest;\n            }\n            catch (err) {\n                return null;\n            }\n            if (!manifest) {\n                return null;\n            }\n            let needsAlias = (typeof manifest.module === 'string' &&\n                source === path.posix.join(packageFullName, manifest.module)) ||\n                (typeof manifest.browser === 'string' &&\n                    source === path.posix.join(packageFullName, manifest.browser)) ||\n                (typeof manifest.main === 'string' &&\n                    source === path.posix.join(packageFullName, manifest.main));\n            if (!needsAlias) {\n                return null;\n            }\n            return this.resolve(packageFullName, importer, { skipSelf: true }).then((resolved) => {\n                return resolved || null;\n            });\n        },\n    };\n}\n","import isNodeBuiltin from 'is-builtin-module';\n/**\n * rollup-plugin-catch-unresolved\n *\n * Catch any unresolved imports to give proper warnings (Rollup default is to ignore).\n */\nexport function rollupPluginCatchUnresolved() {\n    return {\n        name: 'snowpack:rollup-plugin-catch-unresolved',\n        resolveId(id, importer) {\n            if (isNodeBuiltin(id)) {\n                this.warn({\n                    id: importer,\n                    message: `\"${id}\" (Node.js built-in) could not be resolved. (https://www.snowpack.dev/#node-built-in-could-not-be-resolved)`,\n                });\n            }\n            else {\n                this.warn({\n                    id: importer,\n                    message: `\"${id}\" could not be resolved. (Is it installed?)`,\n                });\n            }\n            return false;\n        },\n    };\n}\n","import path from 'path';\nimport chalk from 'chalk';\nfunction autoDetectExports(fileLoc) {\n    try {\n        return Object.keys(require(fileLoc));\n    }\n    catch (err) {\n        console.error(chalk.red(`✘ Could not auto-detect exports for ${chalk.bold(fileLoc)}\\n${err.message}`));\n    }\n}\n/**\n * rollup-plugin-wrap-install-targets\n *\n * How it works:\n * 1. An array of \"install targets\" are passed in, describing all known imports + metadata.\n * 2. If isTreeshake: Known imports are marked for tree-shaking by appending 'snowpack-wrap:' to the input value.\n * 3. If autoDetectPackageExports match: Also mark for wrapping, and use automatic export detection.\n * 4. On load, we return a false virtual file for all \"snowpack-wrap:\" inputs.\n *    a. That virtual file contains only `export ... from 'ACTUAL_FILE_PATH';` exports\n *    b. Rollup uses those exports to drive its tree-shaking algorithm.\n *    c. Rollup uses those exports to inform its \"namedExports\" for Common.js entrypoints.\n */\nexport function rollupPluginWrapInstallTargets(isTreeshake, autoDetectPackageExports, installTargets) {\n    const installTargetsByFile = {};\n    function isAutoDetect(normalizedFileLoc) {\n        return autoDetectPackageExports.some((p) => normalizedFileLoc.includes(`node_modules/${p}${p.endsWith('index.js') ? '' : '/'}`));\n    }\n    return {\n        name: 'snowpack:wrap-install-targets',\n        // Mark some inputs for tree-shaking.\n        options(inputOptions) {\n            const input = inputOptions.input;\n            for (const [key, val] of Object.entries(input)) {\n                installTargetsByFile[val] = installTargets.filter((imp) => imp.specifier === key);\n                if (isTreeshake &&\n                    installTargetsByFile[val].length > 0 &&\n                    !installTargetsByFile[val].some((imp) => imp.namespace || imp.all)) {\n                    input[key] = `snowpack-wrap:${val}`;\n                }\n                if (!isTreeshake) {\n                    const normalizedFileLoc = val.split(path.win32.sep).join(path.posix.sep);\n                    if (isAutoDetect(normalizedFileLoc)) {\n                        input[key] = `snowpack-wrap:${val}`;\n                    }\n                }\n            }\n            return inputOptions;\n        },\n        resolveId(source) {\n            if (source.startsWith('snowpack-wrap:')) {\n                return source;\n            }\n            return null;\n        },\n        load(id) {\n            if (!id.startsWith('snowpack-wrap:')) {\n                return null;\n            }\n            const fileLoc = id.substring('snowpack-wrap:'.length);\n            // Reduce all install targets into a single \"summarized\" install target.\n            const treeshakeSummary = installTargetsByFile[fileLoc].reduce((summary, imp) => {\n                summary.default = summary.default || imp.default;\n                summary.namespace = summary.namespace || imp.namespace;\n                summary.named = [...summary.named, ...imp.named];\n                return summary;\n            });\n            let uniqueNamedImports = Array.from(new Set(treeshakeSummary.named));\n            const normalizedFileLoc = fileLoc.split(path.win32.sep).join(path.posix.sep);\n            if (!isTreeshake && isAutoDetect(normalizedFileLoc)) {\n                uniqueNamedImports = autoDetectExports(fileLoc) || uniqueNamedImports;\n            }\n            const result = `\n        ${treeshakeSummary.namespace ? `export * from '${normalizedFileLoc}';` : ''}\n        ${treeshakeSummary.default\n                ? `import __pika_web_default_export_for_treeshaking__ from '${normalizedFileLoc}'; export default __pika_web_default_export_for_treeshaking__;`\n                : ''}\n        ${`export {${uniqueNamedImports.join(',')}} from '${normalizedFileLoc}';`}\n      `;\n            return result;\n        },\n    };\n}\n","import mkdirp from 'mkdirp';\nimport cacache from 'cacache';\nimport url from 'url';\nimport fs from 'fs';\nimport path from 'path';\nimport tar from 'tar';\nimport { fetchCDNResource, HAS_CDN_HASH_REGEX, PIKA_CDN, RESOURCE_CACHE } from './util';\nconst CACHED_FILE_ID_PREFIX = 'snowpack-pkg-cache:';\nconst PIKA_CDN_TRIM_LENGTH = PIKA_CDN.length;\n/**\n * rollup-plugin-remote-cdn\n *\n * Load import URLs from a remote CDN, sitting behind a local cache. The local\n * cache acts as a go-between for the resolve & load step: when we get back a\n * successful CDN resolution, we save the file to the local cache and then tell\n * rollup that it's safe to load from the cache in the `load()` hook.\n */\nexport function rollupPluginDependencyCache({ installTypes, log, }) {\n    const allTypesToInstall = new Set();\n    return {\n        name: 'snowpack:rollup-plugin-remote-cdn',\n        async resolveId(source, importer) {\n            let cacheKey;\n            if (source.startsWith(PIKA_CDN)) {\n                cacheKey = source;\n            }\n            else if (source.startsWith('/-/')) {\n                cacheKey = PIKA_CDN + source;\n            }\n            else if (source.startsWith('/pin/')) {\n                cacheKey = PIKA_CDN + source;\n            }\n            else {\n                return null;\n            }\n            // If the source path is a CDN path including a hash, it's assumed the\n            // file will never change and it is safe to pull from our local cache\n            // without a network request.\n            log(cacheKey);\n            if (HAS_CDN_HASH_REGEX.test(cacheKey)) {\n                const cachedResult = await cacache.get\n                    .info(RESOURCE_CACHE, cacheKey)\n                    .catch(( /* ignore */) => null);\n                if (cachedResult) {\n                    return CACHED_FILE_ID_PREFIX + cacheKey;\n                }\n            }\n            // Otherwise, make the remote request and cache the file on success.\n            const response = await fetchCDNResource(cacheKey);\n            if (response.statusCode === 200) {\n                const typesUrlPath = response.headers['x-typescript-types'];\n                const pinnedUrlPath = response.headers['x-pinned-url'];\n                const typesUrl = typesUrlPath && `${PIKA_CDN}${typesUrlPath}`;\n                const pinnedUrl = pinnedUrlPath && `${PIKA_CDN}${pinnedUrlPath}`;\n                await cacache.put(RESOURCE_CACHE, cacheKey, response.body, {\n                    metadata: { pinnedUrl, typesUrl },\n                });\n                return CACHED_FILE_ID_PREFIX + cacheKey;\n            }\n            // If lookup failed, skip this plugin and resolve the import locally instead.\n            // TODO: Log that this has happened (if some sort of verbose mode is enabled).\n            const packageName = cacheKey\n                .substring(PIKA_CDN_TRIM_LENGTH)\n                .replace('/-/', '')\n                .replace('/pin/', '')\n                .split('@')[0];\n            return this.resolve(packageName, importer, { skipSelf: true }).then((resolved) => {\n                let finalResult = resolved;\n                if (!finalResult) {\n                    finalResult = { id: packageName };\n                }\n                return finalResult;\n            });\n        },\n        async load(id) {\n            if (!id.startsWith(CACHED_FILE_ID_PREFIX)) {\n                return null;\n            }\n            const cacheKey = id.substring(CACHED_FILE_ID_PREFIX.length);\n            log(cacheKey);\n            const cachedResult = await cacache.get(RESOURCE_CACHE, cacheKey);\n            const typesUrl = cachedResult.metadata?.typesUrl;\n            if (typesUrl && installTypes) {\n                const typesTarballUrl = typesUrl.replace(/(mode=types.*?)\\/.*/, '$1/all.tgz');\n                allTypesToInstall.add(typesTarballUrl);\n            }\n            return cachedResult.data.toString('utf8');\n        },\n        async writeBundle(options) {\n            if (!installTypes) {\n                return;\n            }\n            await mkdirp(path.join(options.dir, '.types'));\n            const tempDir = await cacache.tmp.mkdir(RESOURCE_CACHE);\n            for (const typesTarballUrl of allTypesToInstall) {\n                let tarballContents;\n                const cachedTarball = await cacache\n                    .get(RESOURCE_CACHE, typesTarballUrl)\n                    .catch(( /* ignore */) => null);\n                if (cachedTarball) {\n                    tarballContents = cachedTarball.data;\n                }\n                else {\n                    const tarballResponse = await fetchCDNResource(typesTarballUrl, 'buffer');\n                    if (tarballResponse.statusCode !== 200) {\n                        continue;\n                    }\n                    tarballContents = tarballResponse.body;\n                    await cacache.put(RESOURCE_CACHE, typesTarballUrl, tarballContents);\n                }\n                const typesUrlParts = url.parse(typesTarballUrl).pathname.split('/');\n                const typesPackageName = url.parse(typesTarballUrl).pathname.startsWith('/-/@')\n                    ? typesUrlParts[2] + '/' + typesUrlParts[3].split('@')[0]\n                    : typesUrlParts[2].split('@')[0];\n                const typesPackageTarLoc = path.join(tempDir, `${typesPackageName}.tgz`);\n                if (typesPackageName.includes('/')) {\n                    await mkdirp(path.dirname(typesPackageTarLoc));\n                }\n                fs.writeFileSync(typesPackageTarLoc, tarballContents);\n                const typesPackageLoc = path.join(options.dir, `.types/${typesPackageName}`);\n                await mkdirp(typesPackageLoc);\n                await tar.x({\n                    file: typesPackageTarLoc,\n                    cwd: typesPackageLoc,\n                });\n            }\n        },\n    };\n}\n","import fs from 'fs';\nimport path from 'path';\nimport zlib from 'zlib';\nexport function rollupPluginDependencyStats(cb) {\n    let outputDir;\n    let existingFileCache = {};\n    let statsSummary = {\n        direct: {},\n        common: {},\n    };\n    function buildExistingFileCache(bundle) {\n        for (let fileName of Object.keys(bundle)) {\n            const filePath = path.join(outputDir, fileName);\n            if (fs.existsSync(filePath)) {\n                const { size } = fs.statSync(filePath);\n                existingFileCache[fileName] = size;\n            }\n        }\n    }\n    function compareDependencies(files, type) {\n        for (let { fileName, contents } of files) {\n            const size = contents.byteLength;\n            statsSummary[type][fileName] = {\n                size: size,\n                gzip: zlib.gzipSync(contents).byteLength,\n                brotli: zlib.brotliCompressSync ? zlib.brotliCompressSync(contents).byteLength : 0,\n            };\n            if (existingFileCache[fileName]) {\n                const delta = (size - existingFileCache[fileName]) / 1000;\n                statsSummary[type][fileName].delta = delta;\n            }\n        }\n    }\n    return {\n        name: 'snowpack:rollup-plugin-stats',\n        generateBundle(options, bundle) {\n            outputDir = options.dir;\n            buildExistingFileCache(bundle);\n        },\n        writeBundle(options, bundle) {\n            const directDependencies = [];\n            const commonDependencies = [];\n            for (const [fileName, assetOrChunk] of Object.entries(bundle)) {\n                const raw = assetOrChunk.type === 'asset' ? assetOrChunk.source : assetOrChunk.code;\n                const contents = Buffer.isBuffer(raw)\n                    ? raw\n                    : typeof raw === 'string'\n                        ? Buffer.from(raw, 'utf8')\n                        : Buffer.from(raw);\n                if (fileName.startsWith('common')) {\n                    commonDependencies.push({ fileName, contents });\n                }\n                else {\n                    directDependencies.push({ fileName, contents });\n                }\n            }\n            compareDependencies(directDependencies, 'direct');\n            compareDependencies(commonDependencies, 'common');\n            cb(statsSummary);\n        },\n    };\n}\n","import chalk from 'chalk';\nimport { init as initESModuleLexer, parse } from 'es-module-lexer';\nimport fs from 'fs';\nimport glob from 'glob';\nimport mime from 'mime-types';\nimport nodePath from 'path';\nimport stripComments from 'strip-comments';\nimport validatePackageName from 'validate-npm-package-name';\nimport { isTruthy, findMatchingMountScript } from './util';\nconst WEB_MODULES_TOKEN = 'web_modules/';\nconst WEB_MODULES_TOKEN_LENGTH = WEB_MODULES_TOKEN.length;\n// [@\\w] - Match a word-character or @ (valid package name)\n// (?!.*(:\\/\\/)) - Ignore if previous match was a protocol (ex: http://)\nconst BARE_SPECIFIER_REGEX = /^[@\\w](?!.*(:\\/\\/))/;\nconst ESM_IMPORT_REGEX = /import(?:[\"'\\s]*([\\w*${}\\n\\r\\t, ]+)\\s*from\\s*)?\\s*[\"'](.*?)[\"']/gm;\nconst ESM_DYNAMIC_IMPORT_REGEX = /import\\((?:['\"].+['\"]|`[^$]+`)\\)/gm;\nconst HAS_NAMED_IMPORTS_REGEX = /^[\\w\\s\\,]*\\{(.*)\\}/s;\nconst SPLIT_NAMED_IMPORTS_REGEX = /\\bas\\s+\\w+|,/s;\nconst DEFAULT_IMPORT_REGEX = /import\\s+(\\w)+(,\\s\\{[\\w\\s]*\\})?\\s+from/s;\nconst HTML_JS_REGEX = /<script.*?>(.*)<\\/script>/gms;\nfunction stripJsExtension(dep) {\n    return dep.replace(/\\.m?js$/i, '');\n}\nfunction createInstallTarget(specifier, all = true) {\n    return {\n        specifier,\n        all,\n        default: false,\n        namespace: false,\n        named: [],\n    };\n}\nfunction removeSpecifierQueryString(specifier) {\n    const queryStringIndex = specifier.indexOf('?');\n    if (queryStringIndex >= 0) {\n        specifier = specifier.substring(0, queryStringIndex);\n    }\n    return specifier;\n}\nfunction getWebModuleSpecifierFromCode(code, imp) {\n    // import.meta: we can ignore\n    if (imp.d === -2) {\n        return null;\n    }\n    // Static imports: easy to parse\n    if (imp.d === -1) {\n        return code.substring(imp.s, imp.e);\n    }\n    // Dynamic imports: a bit trickier to parse. Today, we only support string literals.\n    const importStatement = code.substring(imp.s, imp.e);\n    const importSpecifierMatch = importStatement.match(/^\\s*['\"](.*)['\"]\\s*$/m);\n    return importSpecifierMatch ? importSpecifierMatch[1] : null;\n}\n/**\n * parses an import specifier, looking for a web modules to install. If a web module is not detected,\n * null is returned.\n */\nfunction parseWebModuleSpecifier(specifier) {\n    if (!specifier) {\n        return null;\n    }\n    // If specifier is a \"bare module specifier\" (ie: package name) just return it directly\n    if (BARE_SPECIFIER_REGEX.test(specifier)) {\n        return specifier;\n    }\n    // Clean the specifier, remove any query params that may mess with matching\n    const cleanedSpecifier = removeSpecifierQueryString(specifier);\n    // Otherwise, check that it includes the \"web_modules/\" directory\n    const webModulesIndex = cleanedSpecifier.indexOf(WEB_MODULES_TOKEN);\n    if (webModulesIndex === -1) {\n        return null;\n    }\n    // Check if this matches `@scope/package.js` or `package.js` format.\n    // If it is, assume that this is a top-level pcakage that should be installed without the “.js”\n    const resolvedSpecifier = cleanedSpecifier.substring(webModulesIndex + WEB_MODULES_TOKEN_LENGTH);\n    const resolvedSpecifierWithoutExtension = stripJsExtension(resolvedSpecifier);\n    if (validatePackageName(resolvedSpecifierWithoutExtension).validForNewPackages) {\n        return resolvedSpecifierWithoutExtension;\n    }\n    // Otherwise, this is an explicit import to a file within a package.\n    return resolvedSpecifier;\n}\nfunction parseImportStatement(code, imp) {\n    const webModuleSpecifier = parseWebModuleSpecifier(getWebModuleSpecifierFromCode(code, imp));\n    if (!webModuleSpecifier) {\n        return null;\n    }\n    const importStatement = code.substring(imp.ss, imp.se);\n    if (/^import\\s+type/.test(importStatement)) {\n        return null;\n    }\n    const isDynamicImport = imp.d > -1;\n    const hasDefaultImport = !isDynamicImport && DEFAULT_IMPORT_REGEX.test(importStatement);\n    const hasNamespaceImport = !isDynamicImport && importStatement.includes('*');\n    const namedImports = (importStatement.match(HAS_NAMED_IMPORTS_REGEX) || [, ''])[1]\n        .split(SPLIT_NAMED_IMPORTS_REGEX)\n        .map((name) => name.trim())\n        .filter(isTruthy);\n    return {\n        specifier: webModuleSpecifier,\n        all: isDynamicImport || (!hasDefaultImport && !hasNamespaceImport && namedImports.length === 0),\n        default: hasDefaultImport,\n        namespace: hasNamespaceImport,\n        named: namedImports,\n    };\n}\nfunction cleanCodeForParsing(code) {\n    code = stripComments(code);\n    const allMatches = [];\n    let match;\n    const importRegex = new RegExp(ESM_IMPORT_REGEX);\n    while ((match = importRegex.exec(code))) {\n        allMatches.push(match);\n    }\n    const dynamicImportRegex = new RegExp(ESM_DYNAMIC_IMPORT_REGEX);\n    while ((match = dynamicImportRegex.exec(code))) {\n        allMatches.push(match);\n    }\n    return allMatches.map(([full]) => full).join('\\n');\n}\nfunction parseCodeForInstallTargets(fileLoc, code) {\n    let imports;\n    // Attempt #1: Parse the file as JavaScript. JSX and some decorator\n    // syntax will break this.\n    try {\n        if (fileLoc.endsWith('.jsx') || fileLoc.endsWith('.tsx')) {\n            // We know ahead of time that this will almost certainly fail.\n            // Just jump right to the secondary attempt.\n            throw new Error('JSX must be cleaned before parsing');\n        }\n        [imports] = parse(code) || [];\n    }\n    catch (err) {\n        // Attempt #2: Parse only the import statements themselves.\n        // This lets us guarentee we aren't sending any broken syntax to our parser,\n        // but at the expense of possible false +/- caused by our regex extractor.\n        try {\n            code = cleanCodeForParsing(code);\n            [imports] = parse(code) || [];\n        }\n        catch (err) {\n            // Another error! No hope left, just abort.\n            console.error(chalk.red(`! ${fileLoc}`));\n            throw err;\n        }\n    }\n    const allImports = imports\n        .map((imp) => parseImportStatement(code, imp))\n        .filter(isTruthy)\n        // Babel macros are not install targets!\n        .filter((imp) => !/[./]macro(\\.js)?$/.test(imp.specifier));\n    return allImports;\n}\nexport function scanDepList(depList, cwd) {\n    return depList\n        .map((whitelistItem) => {\n        if (!glob.hasMagic(whitelistItem)) {\n            return [createInstallTarget(whitelistItem, true)];\n        }\n        else {\n            const nodeModulesLoc = nodePath.join(cwd, 'node_modules');\n            return scanDepList(glob.sync(whitelistItem, { cwd: nodeModulesLoc, nodir: true }), cwd);\n        }\n    })\n        .reduce((flat, item) => flat.concat(item), []);\n}\nexport async function scanImports(cwd, { scripts, exclude }) {\n    await initESModuleLexer;\n    const includeFileSets = await Promise.all(scripts.map(({ id, type, cmd, args }) => {\n        if (type !== 'mount') {\n            return [];\n        }\n        if (args.fromDisk.includes('web_modules')) {\n            return [];\n        }\n        const dirDisk = nodePath.resolve(cwd, args.fromDisk);\n        return glob.sync(`**/*`, {\n            ignore: exclude.concat(['**/web_modules/**/*']),\n            cwd: dirDisk,\n            absolute: true,\n            nodir: true,\n        });\n    }));\n    const includeFiles = Array.from(new Set([].concat.apply([], includeFileSets)));\n    if (includeFiles.length === 0) {\n        return [];\n    }\n    // Scan every matched JS file for web dependency imports\n    const loadedFiles = await Promise.all(includeFiles.map(async (filePath) => {\n        const ext = nodePath.extname(filePath);\n        // Always ignore dotfiles\n        if (filePath.startsWith('.')) {\n            return null;\n        }\n        // Probably a license, a README, etc\n        if (ext === '') {\n            return null;\n        }\n        // Our import scanner can handle normal JS & even TypeScript without a problem.\n        if (ext === '.js' || ext === '.mjs' || ext === '.ts' || ext === '.jsx' || ext === '.tsx') {\n            return [filePath, await fs.promises.readFile(filePath, 'utf-8')];\n        }\n        if (ext === '.vue' || ext === '.svelte' || ext === '.html') {\n            const result = await fs.promises.readFile(filePath, 'utf-8');\n            // TODO: Replace with matchAll once Node v10 is out of TLS.\n            // const allMatches = [...result.matchAll(new RegExp(HTML_JS_REGEX))];\n            const allMatches = [];\n            let match;\n            const regex = new RegExp(HTML_JS_REGEX);\n            while ((match = regex.exec(result))) {\n                allMatches.push(match);\n            }\n            return [filePath, allMatches.map(([full, code]) => code).join('\\n')];\n        }\n        // If we don't recognize the file type, it could be source. Warn just in case.\n        if (!mime.lookup(nodePath.extname(filePath))) {\n            console.warn(chalk.dim(`ignoring unsupported file \"${nodePath.relative(process.cwd(), filePath)}\"`));\n        }\n        return null;\n    }));\n    return (loadedFiles\n        .filter(isTruthy)\n        .map(([fileLoc, code]) => parseCodeForInstallTargets(fileLoc, code))\n        .reduce((flat, item) => flat.concat(item), [])\n        // Ignore source imports that match a mount directory.\n        .filter((target) => !findMatchingMountScript(scripts, target.specifier))\n        .sort((impA, impB) => impA.specifier.localeCompare(impB.specifier)));\n}\n","import chalk from 'chalk';\n/** The minimum width, in characters, of each size column */\nconst SIZE_COLUMN_WIDTH = 11;\n/** Generic Object.entries() alphabetical sort by keys. */\nfunction entriesSort([filenameA], [filenameB]) {\n    return filenameA.localeCompare(filenameB);\n}\n/** Pretty-prints number of bytes as \"XXX KB\" */\nfunction formatSize(size) {\n    let kb = Math.round((size / 1000) * 100) / 100;\n    if (kb >= 1000) {\n        kb = Math.floor(kb);\n    }\n    let color;\n    if (kb < 15) {\n        color = 'green';\n    }\n    else if (kb < 30) {\n        color = 'yellow';\n    }\n    else {\n        color = 'red';\n    }\n    return chalk[color](`${kb} KB`.padEnd(SIZE_COLUMN_WIDTH));\n}\nfunction formatDelta(delta) {\n    const kb = Math.round(delta * 100) / 100;\n    const color = delta > 0 ? 'red' : 'green';\n    return chalk[color](`Δ ${delta > 0 ? '+' : ''}${kb} KB`);\n}\nfunction formatFileInfo(filename, stats, padEnd, isLastFile) {\n    const lineGlyph = chalk.dim(isLastFile ? '└─' : '├─');\n    const lineName = filename.padEnd(padEnd);\n    const fileStat = formatSize(stats.size);\n    const gzipStat = formatSize(stats.gzip);\n    const brotliStat = formatSize(stats.brotli);\n    const lineStat = fileStat + gzipStat + brotliStat;\n    let lineDelta = '';\n    if (stats.delta) {\n        lineDelta = chalk.dim('[') + formatDelta(stats.delta) + chalk.dim(']');\n    }\n    // Trim trailing whitespace (can mess with formatting), but keep indentation.\n    return `    ` + `${lineGlyph} ${lineName} ${lineStat} ${lineDelta}`.trim();\n}\nfunction formatFiles(files, padEnd) {\n    const strippedFiles = files.map(([filename, stats]) => [\n        filename.replace(/^common\\//, ''),\n        stats,\n    ]);\n    return strippedFiles\n        .map(([filename, stats], index) => formatFileInfo(filename, stats, padEnd, index >= files.length - 1))\n        .join('\\n');\n}\nexport function printStats(dependencyStats) {\n    let output = '';\n    const { direct, common } = dependencyStats;\n    const allDirect = Object.entries(direct).sort(entriesSort);\n    const allCommon = Object.entries(common).sort(entriesSort);\n    const maxFileNameLength = [...allCommon, ...allDirect].reduce((max, [filename]) => Math.max(filename.length, max), 'web_modules/'.length) + 1;\n    output +=\n        `  ⦿ ${chalk.bold('web_modules/'.padEnd(maxFileNameLength + 4))}` +\n            chalk.bold.underline('size'.padEnd(SIZE_COLUMN_WIDTH - 2)) +\n            '  ' +\n            chalk.bold.underline('gzip'.padEnd(SIZE_COLUMN_WIDTH - 2)) +\n            '  ' +\n            chalk.bold.underline('brotli'.padEnd(SIZE_COLUMN_WIDTH - 2)) +\n            `\\n`;\n    output += `${formatFiles(allDirect, maxFileNameLength)}\\n`;\n    if (Object.values(common).length > 0) {\n        output += `  ⦿ ${chalk.bold('web_modules/common/ (Shared)')}\\n`;\n        output += `${formatFiles(allCommon, maxFileNameLength)}\\n`;\n    }\n    return `\\n${output}\\n`;\n}\n","import { init as initESModuleLexer, parse } from 'es-module-lexer';\nimport rollupPluginAlias from '@rollup/plugin-alias';\nimport rollupPluginCommonjs from '@rollup/plugin-commonjs';\nimport rollupPluginJson from '@rollup/plugin-json';\nimport rollupPluginNodeResolve from '@rollup/plugin-node-resolve';\nimport rollupPluginReplace from '@rollup/plugin-replace';\nimport chalk from 'chalk';\nimport fs from 'fs';\nimport mkdirp from 'mkdirp';\nimport ora from 'ora';\nimport path from 'path';\nimport rimraf from 'rimraf';\nimport { rollup } from 'rollup';\nimport validatePackageName from 'validate-npm-package-name';\nimport { resolveTargetsFromRemoteCDN } from '../resolve-remote.js';\nimport { rollupPluginCss } from '../rollup-plugin-css';\nimport { rollupPluginEntrypointAlias } from '../rollup-plugin-entrypoint-alias.js';\nimport { rollupPluginCatchUnresolved } from '../rollup-plugin-catch-unresolved.js';\nimport { rollupPluginWrapInstallTargets } from '../rollup-plugin-wrap-install-targets';\nimport { rollupPluginDependencyCache } from '../rollup-plugin-remote-cdn.js';\nimport { rollupPluginDependencyStats } from '../rollup-plugin-stats.js';\nimport { scanDepList, scanImports } from '../scan-imports.js';\nimport { printStats } from '../stats-formatter.js';\nimport { isTruthy, MISSING_PLUGIN_SUGGESTIONS, resolveDependencyManifest, writeLockfile, } from '../util.js';\nclass ErrorWithHint extends Error {\n    constructor(message, hint) {\n        super(message);\n        this.hint = hint;\n    }\n}\n// Add popular CJS packages here that use \"synthetic\" named imports in their documentation.\n// CJS packages should really only be imported via the default export:\n//   import React from 'react';\n// But, some large projects use named exports in their documentation:\n//   import {useState} from 'react';\n//\n// We use \"/index.js here to match the official package, but not any ESM aliase packages\n// that the user may have installed instead (ex: react-esm).\nconst CJS_PACKAGES_TO_AUTO_DETECT = [\n    'react/index.js',\n    'react-dom/index.js',\n    'react-is/index.js',\n    'prop-types/index.js',\n    'scheduler/index.js',\n    'react-table',\n];\nconst cwd = process.cwd();\nconst banner = chalk.bold(`snowpack`) + ` installing... `;\nlet spinner = ora(banner);\nlet spinnerHasError = false;\nlet installResults = [];\nlet dependencyStats = null;\nfunction defaultLogError(msg) {\n    if (!spinnerHasError) {\n        spinner.stopAndPersist({ symbol: chalk.cyan('⠼') });\n    }\n    spinnerHasError = true;\n    spinner = ora(chalk.red(msg));\n    spinner.fail();\n}\nfunction defaultLogUpdate(msg) {\n    spinner.text = banner + msg;\n}\nfunction formatInstallResults() {\n    return installResults\n        .map(([d, result]) => {\n        if (result === 'SUCCESS') {\n            return chalk.green(d);\n        }\n        if (result === 'ASSET') {\n            return chalk.yellow(d);\n        }\n        if (result === 'FAIL') {\n            return chalk.red(d);\n        }\n        return d;\n    })\n        .join(', ');\n}\n/**\n * Formats the snowpack dependency name from a \"webDependencies\" input value:\n * 2. Remove any \".js\"/\".mjs\" extension (will be added automatically by Rollup)\n */\nfunction getWebDependencyName(dep) {\n    return dep.replace(/\\.m?js$/i, '');\n}\n/**\n * Takes object of env var mappings and converts it to actual\n * replacement specs as expected by @rollup/plugin-replace. The\n * `optimize` arg is used to derive NODE_ENV default.\n *\n * @param env\n * @param optimize\n */\nfunction getRollupReplaceKeys(env) {\n    const result = Object.keys(env).reduce((acc, id) => {\n        const val = env[id];\n        acc[`process.env.${id}`] = `${JSON.stringify(val === true ? process.env[id] : val)}`;\n        return acc;\n    }, {\n        'process.env.NODE_ENV': JSON.stringify(process.env.NODE_ENV || 'production'),\n        'process.versions.node': 'undefined',\n        'process.platform': JSON.stringify('browser'),\n        'process.env.': '({}).',\n    });\n    return result;\n}\n/**\n * Resolve a \"webDependencies\" input value to the correct absolute file location.\n * Supports both npm package names, and file paths relative to the node_modules directory.\n * Follows logic similar to Node's resolution logic, but using a package.json's ESM \"module\"\n * field instead of the CJS \"main\" field.\n */\nfunction resolveWebDependency(dep) {\n    // if dep includes a file extension, check that dep isn't a package before returning\n    if (path.extname(dep) && !validatePackageName(dep).validForNewPackages) {\n        const isJSFile = ['.js', '.mjs', '.cjs'].includes(path.extname(dep));\n        return {\n            type: isJSFile ? 'JS' : 'ASSET',\n            loc: require.resolve(dep, { paths: [cwd] }),\n        };\n    }\n    const [depManifestLoc, depManifest] = resolveDependencyManifest(dep, cwd);\n    // Fix: import '@material-ui/icons/AddBox' could be a JS file w/o a file extension.\n    // Check Node's resolution logic in case this is actually a file.\n    if (!depManifest) {\n        try {\n            const maybeLoc = require.resolve(dep, { paths: [cwd] });\n            return {\n                type: 'JS',\n                loc: maybeLoc,\n            };\n        }\n        catch (err) {\n            // Oh well, was worth a try\n        }\n    }\n    if (!depManifestLoc || !depManifest) {\n        throw new ErrorWithHint(`Package \"${dep}\" not found. Have you installed it?`, depManifestLoc ? chalk.italic(depManifestLoc) : '');\n    }\n    if (depManifest.name &&\n        (depManifest.name.startsWith('@reactesm') || depManifest.name.startsWith('@pika/react'))) {\n        throw new Error(`React workaround packages no longer needed! Revert back to the official React & React-DOM packages.`);\n    }\n    let foundEntrypoint = depManifest['browser:module'] ||\n        depManifest.module ||\n        depManifest['main:esnext'] ||\n        depManifest.browser;\n    // Some packages define \"browser\" as an object. We'll do our best to find the\n    // right entrypoint in an entrypoint object, or fail otherwise.\n    // See: https://github.com/defunctzombie/package-browser-field-spec\n    if (typeof foundEntrypoint === 'object') {\n        foundEntrypoint =\n            foundEntrypoint[dep] ||\n                foundEntrypoint['./index.js'] ||\n                foundEntrypoint['./index'] ||\n                foundEntrypoint['./'] ||\n                foundEntrypoint['.'];\n    }\n    // If the package was a part of the explicit whitelist, fallback to it's main CJS entrypoint.\n    if (!foundEntrypoint) {\n        foundEntrypoint = depManifest.main || 'index.js';\n    }\n    if (typeof foundEntrypoint !== 'string') {\n        throw new Error(`\"${dep}\" has unexpected entrypoint: ${JSON.stringify(foundEntrypoint)}.`);\n    }\n    return {\n        type: 'JS',\n        loc: require.resolve(path.join(depManifestLoc || '', '..', foundEntrypoint)),\n    };\n}\nfunction checkIsEsModule(fileLoc) {\n    const code = fs.readFileSync(fileLoc, 'utf8');\n    const result = parse(code);\n    return result[0].length > 0 || result[1].length > 0;\n}\nfunction filterPackageIsEsModule(externalPackages) {\n    return externalPackages\n        .map((spec) => [spec, resolveWebDependency(spec)])\n        .filter(([spec, { type, loc }]) => type === 'JS')\n        .filter(([spec, { type, loc }]) => checkIsEsModule(loc))\n        .map(([spec]) => spec);\n}\nexport async function install(installTargets, { lockfile, logError, logUpdate }, config) {\n    const { webDependencies, installOptions: { installTypes, dest: destLoc, externalPackage: externalPackages, alias: installAlias, sourceMap, env, rollup: userDefinedRollup, treeshake: isTreeshake, }, } = config;\n    // @ts-ignore\n    if (!webDependencies && !process.versions.pnp && !fs.existsSync(path.join(cwd, 'node_modules'))) {\n        logError('no \"node_modules\" directory exists. Did you run \"npm install\" first?');\n        return;\n    }\n    const allInstallSpecifiers = new Set(installTargets\n        .filter((dep) => !externalPackages.includes(dep.specifier))\n        .map((dep) => dep.specifier)\n        .map((specifier) => installAlias[specifier] || specifier)\n        .sort());\n    const installEntrypoints = {};\n    const assetEntrypoints = {};\n    const importMap = { imports: {} };\n    const installTargetsMap = {};\n    const skipFailures = false;\n    const autoDetectNamedExports = [\n        ...CJS_PACKAGES_TO_AUTO_DETECT,\n        ...config.installOptions.namedExports,\n    ];\n    // We run some special processing steps when installing a single package.\n    // Example: namedExports support by default, if package is CJS.\n    const isSinglePackageMode = allInstallSpecifiers.size === 1;\n    for (const installSpecifier of allInstallSpecifiers) {\n        const targetName = getWebDependencyName(installSpecifier);\n        if (lockfile && lockfile.imports[installSpecifier]) {\n            installEntrypoints[targetName] = lockfile.imports[installSpecifier];\n            importMap.imports[installSpecifier] = `./${targetName}.js`;\n            installResults.push([targetName, 'SUCCESS']);\n            logUpdate(formatInstallResults());\n            continue;\n        }\n        try {\n            const { type: targetType, loc: targetLoc } = resolveWebDependency(installSpecifier);\n            if (targetType === 'JS') {\n                installEntrypoints[targetName] = targetLoc;\n                importMap.imports[installSpecifier] = `./${targetName}.js`;\n                Object.entries(installAlias)\n                    .filter(([key, value]) => value === installSpecifier)\n                    .forEach(([key, value]) => {\n                    importMap.imports[key] = `./${targetName}.js`;\n                });\n                installTargetsMap[targetLoc] = installTargets.filter((t) => installSpecifier === t.specifier);\n                installResults.push([installSpecifier, 'SUCCESS']);\n            }\n            else if (targetType === 'ASSET') {\n                assetEntrypoints[targetName] = targetLoc;\n                importMap.imports[installSpecifier] = `./${targetName}`;\n                installResults.push([installSpecifier, 'ASSET']);\n            }\n            logUpdate(formatInstallResults());\n        }\n        catch (err) {\n            installResults.push([installSpecifier, 'FAIL']);\n            logUpdate(formatInstallResults());\n            if (skipFailures) {\n                continue;\n            }\n            // An error occurred! Log it.\n            logError(err.message || err);\n            if (err.hint) {\n                // Note: Wait 1ms to guarantee a log message after the spinner\n                setTimeout(() => console.log(err.hint), 1);\n            }\n            return false;\n        }\n    }\n    if (Object.keys(installEntrypoints).length === 0 && Object.keys(assetEntrypoints).length === 0) {\n        logError(`No ESM dependencies found!`);\n        console.log(chalk.dim(`  At least one dependency must have an ESM \"module\" entrypoint. You can find modern, web-ready packages at ${chalk.underline('https://www.pika.dev')}`));\n        return false;\n    }\n    await initESModuleLexer;\n    let isCircularImportFound = false;\n    const inputOptions = {\n        input: installEntrypoints,\n        external: externalPackages,\n        treeshake: { moduleSideEffects: 'no-external' },\n        plugins: [\n            rollupPluginReplace(getRollupReplaceKeys(env)),\n            rollupPluginEntrypointAlias({ cwd }),\n            !!webDependencies &&\n                rollupPluginDependencyCache({\n                    installTypes,\n                    log: (url) => logUpdate(chalk.dim(url)),\n                }),\n            rollupPluginAlias({\n                entries: Object.entries(installAlias).map(([alias, mod]) => ({\n                    find: alias,\n                    replacement: mod,\n                })),\n            }),\n            rollupPluginNodeResolve({\n                mainFields: ['browser:module', 'module', 'browser', 'main'].filter(isTruthy),\n                extensions: ['.mjs', '.cjs', '.js', '.json'],\n                // whether to prefer built-in modules (e.g. `fs`, `path`) or local ones with the same names\n                preferBuiltins: true,\n                dedupe: userDefinedRollup.dedupe,\n            }),\n            rollupPluginJson({\n                preferConst: true,\n                indent: '  ',\n                compact: false,\n                namedExports: true,\n            }),\n            rollupPluginCss(),\n            rollupPluginCommonjs({\n                extensions: ['.js', '.cjs'],\n                // Workaround: CJS -> ESM isn't supported yet by the plugin, so we needed\n                // to add our own custom workaround here. Requires a fork of\n                // rollupPluginCommonjs that supports the \"externalEsm\" option.\n                externalEsm: isSinglePackageMode && filterPackageIsEsModule(externalPackages),\n            }),\n            rollupPluginWrapInstallTargets(!!isTreeshake, autoDetectNamedExports, installTargets),\n            rollupPluginDependencyStats((info) => (dependencyStats = info)),\n            ...userDefinedRollup.plugins,\n            rollupPluginCatchUnresolved(),\n        ].filter(Boolean),\n        onwarn(warning, warn) {\n            // Warn about the first circular dependency, but then ignore the rest.\n            if (warning.code === 'CIRCULAR_DEPENDENCY') {\n                if (!isCircularImportFound) {\n                    isCircularImportFound = true;\n                    logUpdate(`Warning: 1+ circular dependencies found via \"${warning.importer}\".`);\n                }\n                return;\n            }\n            // Log \"unresolved\" import warnings as an error, causing Snowpack to fail at the end.\n            if (warning.code === 'PLUGIN_WARNING' &&\n                warning.plugin === 'snowpack:rollup-plugin-catch-unresolved') {\n                // Display posix-style on all environments, mainly to help with CI :)\n                const fileName = warning.id.replace(cwd + path.sep, '').replace(/\\\\/g, '/');\n                logError(`${fileName}\\n   ${warning.message}`);\n                return;\n            }\n            warn(warning);\n        },\n    };\n    const outputOptions = {\n        dir: destLoc,\n        format: 'esm',\n        sourcemap: sourceMap,\n        exports: 'named',\n        chunkFileNames: 'common/[name]-[hash].js',\n    };\n    if (Object.keys(installEntrypoints).length > 0) {\n        try {\n            const packageBundle = await rollup(inputOptions);\n            logUpdate(formatInstallResults());\n            await packageBundle.write(outputOptions);\n        }\n        catch (_err) {\n            const err = _err;\n            const errFilePath = err.loc?.file || err.id;\n            if (!errFilePath) {\n                throw err;\n            }\n            // NOTE: Rollup will fail instantly on most errors. Therefore, we can\n            // only report one error at a time. `err.watchFiles` also exists, but\n            // for now `err.loc.file` and `err.id` have all the info that we need.\n            const failedExtension = path.extname(errFilePath);\n            const suggestion = MISSING_PLUGIN_SUGGESTIONS[failedExtension] || err.message;\n            // Display posix-style on all environments, mainly to help with CI :)\n            const fileName = errFilePath.replace(cwd + path.sep, '').replace(/\\\\/g, '/');\n            logError(`${chalk.bold('snowpack')} failed to load ${chalk.bold(fileName)}\\n  ${suggestion}`);\n            return;\n        }\n    }\n    await writeLockfile(path.join(destLoc, 'import-map.json'), importMap);\n    Object.entries(assetEntrypoints).forEach(([assetName, assetLoc]) => {\n        mkdirp.sync(path.dirname(`${destLoc}/${assetName}`));\n        fs.copyFileSync(assetLoc, `${destLoc}/${assetName}`);\n    });\n    return true;\n}\nexport async function command({ cwd, config, lockfile, pkgManifest }) {\n    const { installOptions: { dest }, knownEntrypoints, webDependencies, } = config;\n    installResults = [];\n    dependencyStats = null;\n    spinner = ora(banner);\n    spinnerHasError = false;\n    let newLockfile = null;\n    const installTargets = [];\n    if (knownEntrypoints) {\n        installTargets.push(...scanDepList(knownEntrypoints, cwd));\n    }\n    if (webDependencies) {\n        installTargets.push(...scanDepList(Object.keys(webDependencies), cwd));\n    }\n    {\n        installTargets.push(...(await scanImports(cwd, config)));\n    }\n    if (installTargets.length === 0) {\n        defaultLogError('Nothing to install.');\n        return;\n    }\n    spinner.start();\n    const startTime = Date.now();\n    if (webDependencies && Object.keys(webDependencies).length > 0) {\n        newLockfile = await resolveTargetsFromRemoteCDN(lockfile, pkgManifest, config).catch((err) => {\n            defaultLogError(err.message || err);\n            process.exit(1);\n        });\n    }\n    rimraf.sync(dest);\n    await mkdirp(dest);\n    const finalResult = await install(installTargets, {\n        lockfile: newLockfile,\n        logError: defaultLogError,\n        logUpdate: defaultLogUpdate,\n    }, config).catch((err) => {\n        if (err.loc) {\n            console.log('\\n' + chalk.red.bold(`✘ ${err.loc.file}`));\n        }\n        if (err.url) {\n            console.log(chalk.dim(`👉 ${err.url}`));\n        }\n        throw err;\n    });\n    if (finalResult) {\n        spinner.succeed(chalk.bold(`snowpack`) +\n            ` install complete${spinnerHasError ? ' with errors.' : '.'}` +\n            chalk.dim(` [${((Date.now() - startTime) / 1000).toFixed(2)}s]`));\n        if (!!dependencyStats) {\n            console.log(printStats(dependencyStats));\n        }\n    }\n    if (newLockfile) {\n        await writeLockfile(path.join(cwd, 'snowpack.lock.json'), newLockfile);\n    }\n    if (spinnerHasError) {\n        process.exit(1);\n    }\n}\n","import chalk from 'chalk';\nimport readline from 'readline';\nimport util from 'util';\nimport { isYarn } from '../util';\nimport detectPort from 'detect-port';\nconst cwd = process.cwd();\n/**\n * Get the actual port, based on the `defaultPort`.\n * If the default port was not available, then we'll prompt the user if its okay\n * to use the next available port.\n */\nexport async function getPort(defaultPort) {\n    const bestAvailablePort = await detectPort(defaultPort);\n    if (defaultPort !== bestAvailablePort) {\n        let useNextPort = false;\n        if (process.stdout.isTTY) {\n            const rl = readline.createInterface({ input: process.stdin, output: process.stdout });\n            useNextPort = await new Promise((resolve) => {\n                rl.question(chalk.yellow(`! Port ${chalk.bold(defaultPort)} not available. Run on port ${chalk.bold(bestAvailablePort)} instead? (Y/n) `), (answer) => {\n                    resolve(!/^no?$/i.test(answer));\n                });\n            });\n            rl.close();\n        }\n        if (!useNextPort) {\n            console.error(chalk.red(`✘ Port ${chalk.bold(defaultPort)} not available. Use ${chalk.bold('--port')} to specify a different port.`));\n            console.error();\n            process.exit(1);\n        }\n    }\n    return bestAvailablePort;\n}\nfunction getStateString(workerState, isWatch) {\n    if (workerState.state) {\n        if (Array.isArray(workerState.state)) {\n            return [chalk[workerState.state[1]], workerState.state[0]];\n        }\n        return [chalk.dim, workerState.state];\n    }\n    if (workerState.done) {\n        return workerState.error ? [chalk.red, 'FAIL'] : [chalk.green, 'DONE'];\n    }\n    if (isWatch) {\n        if (workerState.config.watch) {\n            return [chalk.dim, 'WATCH'];\n        }\n    }\n    return [chalk.dim, 'READY'];\n}\nconst WORKER_BASE_STATE = { done: false, error: null, output: '' };\nexport function paint(bus, registeredWorkers, buildMode, devMode) {\n    let port;\n    let protocol = '';\n    let startTimeMs;\n    let ips = [];\n    let consoleOutput = '';\n    let installOutput = '';\n    let isInstalling = false;\n    let hasBeenCleared = false;\n    let missingWebModule = null;\n    const allWorkerStates = {};\n    for (const config of registeredWorkers) {\n        allWorkerStates[config.id] = { ...WORKER_BASE_STATE, config };\n    }\n    function repaint() {\n        process.stdout.write(process.platform === 'win32' ? '\\x1B[2J\\x1B[0f' : '\\x1B[2J\\x1B[3J\\x1B[H');\n        process.stdout.write(`${chalk.bold('Snowpack')}\\n\\n`);\n        // Dashboard\n        if (devMode) {\n            const isServerStarted = startTimeMs > 0 && port > 0 && protocol;\n            if (isServerStarted) {\n                process.stdout.write(`  ${chalk.bold.cyan(`${protocol}//localhost:${port}`)}`);\n                for (const ip of ips) {\n                    process.stdout.write(`${chalk.cyan(` > `)}${chalk.bold.cyan(`${protocol}//${ip}:${port}`)}`);\n                }\n                process.stdout.write('\\n');\n                process.stdout.write(chalk.dim(startTimeMs < 1000 ? `  Server started in ${startTimeMs}ms.` : `  Server started.`));\n                process.stdout.write('\\n\\n');\n            }\n            else {\n                process.stdout.write(chalk.dim(`  Server starting…`) + '\\n\\n');\n            }\n        }\n        if (buildMode) {\n            process.stdout.write('  ' + chalk.bold.cyan(buildMode.dest));\n            process.stdout.write(chalk.dim(` Building your application...\\n\\n`));\n        }\n        for (const config of registeredWorkers) {\n            if (devMode && config.type === 'bundle') {\n                continue;\n            }\n            const workerState = allWorkerStates[config.id];\n            const dotLength = 24 - config.id.length;\n            const dots = chalk.dim(''.padEnd(dotLength, '.'));\n            const [fmt, stateString] = getStateString(workerState, !!devMode);\n            const spacer = ' '; //.padEnd(8 - stateString.length);\n            let cmdMsg = `${config.plugin && config.cmd[0] !== '(' ? '(plugin) ' : ''}${config.cmd}`;\n            if (cmdMsg.length > 52) {\n                cmdMsg = cmdMsg.substr(0, 52) + '...';\n            }\n            const cmdStr = stateString === 'FAIL' ? chalk.red(cmdMsg) : chalk.dim(cmdMsg);\n            process.stdout.write(`  ${config.id}${dots}[${fmt(stateString)}]${spacer}${cmdStr}\\n`);\n        }\n        process.stdout.write('\\n');\n        if (isInstalling) {\n            process.stdout.write(`${chalk.underline.bold('▼ snowpack install')}\\n\\n`);\n            process.stdout.write('  ' + installOutput.trim().replace(/\\n/gm, '\\n  '));\n            process.stdout.write('\\n\\n');\n            return;\n        }\n        if (missingWebModule) {\n            const { id, pkgName, spec } = missingWebModule;\n            process.stdout.write(`${chalk.red.underline.bold('▼ Snowpack')}\\n\\n`);\n            if (devMode) {\n                process.stdout.write(`  Package ${chalk.bold(pkgName)} not found!\\n`);\n                process.stdout.write(chalk.dim(`  in ${id}`));\n                process.stdout.write(`\\n\\n`);\n                process.stdout.write(`  ${chalk.bold('Press Enter')} to automatically run ${chalk.bold(isYarn(cwd) ? `yarn add ${pkgName}` : `npm install --save ${pkgName}`)}.\\n`);\n                process.stdout.write(`  Or, Exit Snowpack and install manually to continue.\\n`);\n            }\n            else {\n                process.stdout.write(`  Dependency ${chalk.bold(spec)} not found!\\n\\n`);\n                // process.stdout.write(\n                //   `  Run ${chalk.bold('snowpack install')} to install all required dependencies.\\n\\n`,\n                // );\n                process.exit(1);\n            }\n            return;\n        }\n        for (const config of registeredWorkers) {\n            const workerState = allWorkerStates[config.id];\n            if (workerState && workerState.output) {\n                const chalkFn = Array.isArray(workerState.error) ? chalk.red : chalk;\n                process.stdout.write(`${chalkFn.underline.bold('▼ ' + config.id)}\\n\\n`);\n                process.stdout.write(workerState.output\n                    ? '  ' + workerState.output.trim().replace(/\\n/gm, '\\n  ')\n                    : hasBeenCleared\n                        ? chalk.dim('  Output cleared.')\n                        : chalk.dim('  No output, yet.'));\n                process.stdout.write('\\n\\n');\n            }\n        }\n        if (consoleOutput) {\n            process.stdout.write(`${chalk.underline.bold('▼ Console')}\\n\\n`);\n            process.stdout.write(consoleOutput\n                ? '  ' + consoleOutput.trim().replace(/\\n/gm, '\\n  ')\n                : hasBeenCleared\n                    ? chalk.dim('  Output cleared.')\n                    : chalk.dim('  No output, yet.'));\n            process.stdout.write('\\n\\n');\n        }\n        const overallStatus = Object.values(allWorkerStates).reduce((result, { done, error }) => {\n            return {\n                done: result.done && done,\n                error: result.error || error,\n            };\n        });\n        if (overallStatus.error) {\n            process.stdout.write(`${chalk.underline.red.bold('▼ Result')}\\n\\n`);\n            process.stdout.write('  ⚠️  Finished, with errors.');\n            process.stdout.write('\\n\\n');\n            process.exit(1);\n        }\n        else if (overallStatus.done) {\n            process.stdout.write(`${chalk.underline.green.bold('▶ Build Complete!')}\\n\\n`);\n        }\n    }\n    bus.on('WORKER_MSG', ({ id, msg }) => {\n        allWorkerStates[id].output += msg;\n        repaint();\n    });\n    bus.on('WORKER_UPDATE', ({ id, state }) => {\n        if (typeof state !== undefined) {\n            allWorkerStates[id].state = state;\n        }\n        repaint();\n    });\n    bus.on('WORKER_COMPLETE', ({ id, error }) => {\n        allWorkerStates[id].state = null;\n        allWorkerStates[id].done = true;\n        allWorkerStates[id].error = allWorkerStates[id].error || error;\n        repaint();\n    });\n    bus.on('WORKER_RESET', ({ id }) => {\n        allWorkerStates[id] = { ...WORKER_BASE_STATE, config: allWorkerStates[id].config };\n        repaint();\n    });\n    bus.on('CONSOLE', ({ level, args }) => {\n        if (isInstalling) {\n            const msg = util.format.apply(util, args);\n            if (!msg.startsWith('[404] ')) {\n                installOutput += msg;\n            }\n        }\n        else {\n            consoleOutput += `[${level}] ${util.format.apply(util, args)}\\n`;\n        }\n        repaint();\n    });\n    bus.on('NEW_SESSION', () => {\n        if (consoleOutput) {\n            consoleOutput = ``;\n            hasBeenCleared = true;\n        }\n        // Reset all per-file build scripts\n        for (const config of registeredWorkers) {\n            if (config.type === 'build') {\n                allWorkerStates[config.id] = {\n                    ...WORKER_BASE_STATE,\n                    config: allWorkerStates[config.id].config,\n                };\n            }\n        }\n        repaint();\n    });\n    bus.on('INSTALLING', () => {\n        isInstalling = true;\n        installOutput = '';\n        repaint();\n    });\n    bus.on('INSTALL_COMPLETE', () => {\n        setTimeout(() => {\n            missingWebModule = null;\n            isInstalling = false;\n            installOutput = '';\n            consoleOutput = ``;\n            hasBeenCleared = true;\n            repaint();\n        }, 2000);\n    });\n    bus.on('MISSING_WEB_MODULE', ({ id, data }) => {\n        if (!missingWebModule && data) {\n            missingWebModule = { id, ...data };\n        }\n        if (missingWebModule && missingWebModule.id === id) {\n            if (!data) {\n                missingWebModule = null;\n            }\n            else {\n                missingWebModule = { id, ...data };\n            }\n        }\n        repaint();\n    });\n    bus.on('SERVER_START', (info) => {\n        startTimeMs = info.startTimeMs;\n        port = info.port;\n        protocol = info.protocol;\n        ips = info.ips;\n        repaint();\n    });\n    if (devMode) {\n        readline.emitKeypressEvents(process.stdin);\n        process.stdin.on('keypress', (str, key) => {\n            if (key.name !== 'return' && key.name !== 'enter') {\n                return;\n            }\n            if (!missingWebModule) {\n                return;\n            }\n            devMode.addPackage(missingWebModule.pkgName);\n            repaint();\n        });\n    }\n    repaint();\n}\n","export default {\n    mjs: 'js',\n    jsx: 'js',\n    ts: 'js',\n    tsx: 'js',\n    vue: 'js',\n    svelte: 'js',\n    mdx: 'js',\n    svx: 'js',\n    elm: 'js',\n    php: 'html',\n    md: 'html',\n    ejs: 'html',\n    njk: 'html',\n    scss: 'css',\n    sass: 'css',\n    less: 'css',\n};\n","import chalk from 'chalk';\nimport { all as merge } from 'deepmerge';\nimport { EventEmitter } from 'events';\nimport execa from 'execa';\nimport { promises as fs } from 'fs';\nimport glob from 'glob';\nimport mkdirp from 'mkdirp';\nimport npmRunPath from 'npm-run-path';\nimport path from 'path';\nimport rimraf from 'rimraf';\nimport { transformEsmImports } from '../rewrite-imports';\nimport { BUILD_DEPENDENCIES_DIR, findMatchingMountScript } from '../util';\nimport { generateEnvModule, getFileBuilderForWorker, isDirectoryImport, wrapCssModuleResponse, wrapEsmProxyResponse, wrapImportMeta, } from './build-util';\nimport { stopEsbuild } from './esbuildPlugin';\nimport { command as installCommand } from './install';\nimport { paint } from './paint';\nimport srcFileExtensionMapping from './src-file-extension-mapping';\nexport async function command(commandOptions) {\n    const { cwd, config } = commandOptions;\n    const configSrcFileExtensionMapping = merge([\n        {},\n        srcFileExtensionMapping,\n        config.extensionMap || {},\n    ]);\n    // Start with a fresh install of your dependencies, for production\n    commandOptions.config.installOptions.env.NODE_ENV = process.env.NODE_ENV || 'production';\n    commandOptions.config.installOptions.dest = BUILD_DEPENDENCIES_DIR;\n    commandOptions.config.installOptions.treeshake =\n        commandOptions.config.installOptions.treeshake !== undefined\n            ? commandOptions.config.installOptions.treeshake\n            : true;\n    const dependencyImportMapLoc = path.join(config.installOptions.dest, 'import-map.json');\n    // Start with a fresh install of your dependencies, always.\n    console.log(chalk.yellow('! rebuilding dependencies...'));\n    await installCommand(commandOptions);\n    const messageBus = new EventEmitter();\n    const relevantWorkers = [];\n    const allBuildExtensions = [];\n    let dependencyImportMap = { imports: {} };\n    try {\n        dependencyImportMap = require(dependencyImportMapLoc);\n    }\n    catch (err) {\n        // no import-map found, safe to ignore\n    }\n    for (const workerConfig of config.scripts) {\n        const { type, match } = workerConfig;\n        if (type === 'build' || type === 'run' || type === 'mount' || type === 'bundle') {\n            relevantWorkers.push(workerConfig);\n        }\n        if (type === 'build') {\n            allBuildExtensions.push(...match);\n        }\n    }\n    let isBundled = config.devOptions.bundle;\n    let bundleWorker = config.scripts.find((s) => s.type === 'bundle');\n    const isBundledHardcoded = isBundled !== undefined;\n    if (!isBundledHardcoded) {\n        isBundled = !!bundleWorker;\n    }\n    if (!bundleWorker) {\n        bundleWorker = {\n            id: 'bundle:*',\n            type: 'bundle',\n            match: ['*'],\n            cmd: '',\n            watch: undefined,\n        };\n        relevantWorkers.push(bundleWorker);\n    }\n    const buildDirectoryLoc = isBundled ? path.join(cwd, `.build`) : config.devOptions.out;\n    const internalFilesBuildLoc = path.join(buildDirectoryLoc, config.buildOptions.metaDir);\n    const finalDirectoryLoc = config.devOptions.out;\n    if (config.scripts.length <= 1) {\n        console.error(chalk.red(`No build scripts found, so nothing to build.`));\n        console.error(`See https://www.snowpack.dev/#build-scripts for help getting started.`);\n        return;\n    }\n    rimraf.sync(buildDirectoryLoc);\n    mkdirp.sync(buildDirectoryLoc);\n    mkdirp.sync(internalFilesBuildLoc);\n    if (finalDirectoryLoc !== buildDirectoryLoc) {\n        rimraf.sync(finalDirectoryLoc);\n        mkdirp.sync(finalDirectoryLoc);\n    }\n    console.log = (...args) => {\n        messageBus.emit('CONSOLE', { level: 'log', args });\n    };\n    console.warn = (...args) => {\n        messageBus.emit('CONSOLE', { level: 'warn', args });\n    };\n    console.error = (...args) => {\n        messageBus.emit('CONSOLE', { level: 'error', args });\n    };\n    let relDest = path.relative(cwd, config.devOptions.out);\n    if (!relDest.startsWith(`..${path.sep}`)) {\n        relDest = `.${path.sep}` + relDest;\n    }\n    paint(messageBus, relevantWorkers, { dest: relDest }, undefined);\n    if (!isBundled) {\n        messageBus.emit('WORKER_UPDATE', {\n            id: bundleWorker.id,\n            state: ['SKIP', 'dim'],\n        });\n    }\n    for (const workerConfig of relevantWorkers) {\n        const { id, type, match } = workerConfig;\n        if (type !== 'run') {\n            continue;\n        }\n        messageBus.emit('WORKER_UPDATE', { id, state: ['RUNNING', 'yellow'] });\n        const workerPromise = execa.command(workerConfig.cmd, {\n            env: npmRunPath.env(),\n            extendEnv: true,\n            shell: true,\n            cwd,\n        });\n        workerPromise.catch((err) => {\n            messageBus.emit('WORKER_MSG', { id, level: 'error', msg: err.toString() });\n            messageBus.emit('WORKER_COMPLETE', { id, error: err });\n        });\n        workerPromise.then(() => {\n            messageBus.emit('WORKER_COMPLETE', { id, error: null });\n        });\n        const { stdout, stderr } = workerPromise;\n        stdout?.on('data', (b) => {\n            let stdOutput = b.toString();\n            if (stdOutput.includes('\\u001bc') || stdOutput.includes('\\x1Bc')) {\n                messageBus.emit('WORKER_RESET', { id });\n                stdOutput = stdOutput.replace(/\\x1Bc/, '').replace(/\\u001bc/, '');\n            }\n            if (id.endsWith(':tsc')) {\n                if (stdOutput.includes('\\u001bc') || stdOutput.includes('\\x1Bc')) {\n                    messageBus.emit('WORKER_UPDATE', { id, state: ['RUNNING', 'yellow'] });\n                }\n                if (/Watching for file changes./gm.test(stdOutput)) {\n                    messageBus.emit('WORKER_UPDATE', { id, state: 'WATCHING' });\n                }\n                const errorMatch = stdOutput.match(/Found (\\d+) error/);\n                if (errorMatch && errorMatch[1] !== '0') {\n                    messageBus.emit('WORKER_UPDATE', { id, state: ['ERROR', 'red'] });\n                }\n            }\n            messageBus.emit('WORKER_MSG', { id, level: 'log', msg: stdOutput });\n        });\n        stderr?.on('data', (b) => {\n            messageBus.emit('WORKER_MSG', { id, level: 'error', msg: b.toString() });\n        });\n        await workerPromise;\n    }\n    // Write the `import.meta.env` contents file to disk\n    await fs.writeFile(path.join(internalFilesBuildLoc, 'env.js'), generateEnvModule('production'));\n    const mountDirDetails = relevantWorkers\n        .map((scriptConfig) => {\n        const { id, type, args } = scriptConfig;\n        if (type !== 'mount') {\n            return false;\n        }\n        const dirDisk = path.resolve(cwd, args.fromDisk);\n        const dirDest = path.resolve(buildDirectoryLoc, args.toUrl.replace(/^\\//, ''));\n        return [id, dirDisk, dirDest];\n    })\n        .filter(Boolean);\n    const includeFileSets = [];\n    const allProxiedFiles = new Set();\n    const allCssModules = new Set();\n    for (const [id, dirDisk, dirDest] of mountDirDetails) {\n        messageBus.emit('WORKER_UPDATE', { id, state: ['RUNNING', 'yellow'] });\n        let allFiles;\n        try {\n            allFiles = glob.sync(`**/*`, {\n                ignore: id === 'mount:web_modules' ? [] : config.exclude,\n                cwd: dirDisk,\n                absolute: true,\n                nodir: true,\n                dot: true,\n            });\n            const allBuildNeededFiles = [];\n            await Promise.all(allFiles.map(async (f) => {\n                f = path.resolve(f); // this is necessary since glob.sync() returns paths with / on windows.  path.resolve() will switch them to the native path separator.\n                if (!f.startsWith(commandOptions.config.installOptions.dest) &&\n                    (allBuildExtensions.includes(path.extname(f).substr(1)) ||\n                        path.extname(f) === '.jsx' ||\n                        path.extname(f) === '.tsx' ||\n                        path.extname(f) === '.ts' ||\n                        path.extname(f) === '.js')) {\n                    allBuildNeededFiles.push(f);\n                    return;\n                }\n                const outPath = f.replace(dirDisk, dirDest);\n                mkdirp.sync(path.dirname(outPath));\n                // replace %PUBLIC_URL% in HTML files\n                if (path.extname(f) === '.html') {\n                    let code = await fs.readFile(f, 'utf8');\n                    code = code.replace(/%PUBLIC_URL%\\/?/g, config.buildOptions.baseUrl);\n                    return fs.writeFile(outPath, code, 'utf8');\n                }\n                return fs.copyFile(f, outPath);\n            }));\n            includeFileSets.push([dirDisk, dirDest, allBuildNeededFiles]);\n            messageBus.emit('WORKER_COMPLETE', { id });\n        }\n        catch (err) {\n            messageBus.emit('WORKER_MSG', { id, level: 'error', msg: err.toString() });\n            messageBus.emit('WORKER_COMPLETE', { id, error: err });\n        }\n    }\n    const allBuiltFromFiles = new Set();\n    const webModulesScript = config.scripts.find((script) => script.id === 'mount:web_modules');\n    const webModulesLoc = webModulesScript ? webModulesScript.args.toUrl : '/web_modules';\n    for (const workerConfig of relevantWorkers) {\n        const { id, match, type } = workerConfig;\n        if (type !== 'build' || match.length === 0) {\n            continue;\n        }\n        messageBus.emit('WORKER_UPDATE', { id, state: ['RUNNING', 'yellow'] });\n        for (const [dirDisk, dirDest, allFiles] of includeFileSets) {\n            for (const f of allFiles) {\n                const fileExtension = path.extname(f).substr(1);\n                if (!match.includes(fileExtension)) {\n                    continue;\n                }\n                const fileContents = await fs.readFile(f, { encoding: 'utf8' });\n                let fileBuilder = getFileBuilderForWorker(cwd, workerConfig, messageBus);\n                if (!fileBuilder) {\n                    continue;\n                }\n                let outPath = f.replace(dirDisk, dirDest);\n                const extToFind = path.extname(f).substr(1);\n                const extToReplace = configSrcFileExtensionMapping[extToFind];\n                if (extToReplace) {\n                    outPath = outPath.replace(new RegExp(`${extToFind}$`), extToReplace);\n                }\n                const builtFile = await fileBuilder({\n                    contents: fileContents,\n                    filePath: f,\n                    isDev: false,\n                });\n                if (!builtFile) {\n                    continue;\n                }\n                let { result: code, resources } = builtFile;\n                const urlPath = outPath.substr(dirDest.length + 1);\n                for (const plugin of config.plugins) {\n                    if (plugin.transform) {\n                        code =\n                            (await plugin.transform({ contents: fileContents, urlPath, isDev: false }))?.result ||\n                                code;\n                    }\n                }\n                if (!code) {\n                    continue;\n                }\n                if (path.extname(outPath) === '.js') {\n                    if (resources?.css) {\n                        const cssOutPath = outPath.replace(/.js$/, '.css');\n                        await fs.mkdir(path.dirname(cssOutPath), { recursive: true });\n                        await fs.writeFile(cssOutPath, resources.css);\n                        code = `import './${path.basename(cssOutPath)}';\\n` + code;\n                    }\n                    code = await transformEsmImports(code, (spec) => {\n                        if (spec.startsWith('http')) {\n                            return spec;\n                        }\n                        let mountScript = findMatchingMountScript(config.scripts, spec);\n                        if (mountScript) {\n                            let { fromDisk, toUrl } = mountScript.args;\n                            spec = spec.replace(fromDisk, toUrl);\n                        }\n                        if (spec.startsWith('/') || spec.startsWith('./') || spec.startsWith('../')) {\n                            const ext = path.extname(spec).substr(1);\n                            if (!ext) {\n                                if (isDirectoryImport(f, spec)) {\n                                    return spec + '/index.js';\n                                }\n                                else {\n                                    return spec + '.js';\n                                }\n                            }\n                            const extToReplace = configSrcFileExtensionMapping[ext];\n                            if (extToReplace) {\n                                spec = spec.replace(new RegExp(`${ext}$`), extToReplace);\n                            }\n                            if (spec.endsWith('.module.css')) {\n                                const resolvedUrl = path.resolve(path.dirname(outPath), spec);\n                                allCssModules.add(resolvedUrl);\n                                spec = spec.replace('.module.css', '.css.module.js');\n                            }\n                            else if (!isBundled && (extToReplace || ext) !== 'js') {\n                                const resolvedUrl = path.resolve(path.dirname(outPath), spec);\n                                allProxiedFiles.add(resolvedUrl);\n                                spec = spec + '.proxy.js';\n                            }\n                            return spec;\n                        }\n                        if (dependencyImportMap.imports[spec]) {\n                            let resolvedImport = path.posix.join(config.buildOptions.baseUrl, webModulesLoc, dependencyImportMap.imports[spec]);\n                            const extName = path.extname(resolvedImport);\n                            if (!isBundled && extName && extName !== '.js') {\n                                resolvedImport = resolvedImport + '.proxy.js';\n                            }\n                            return resolvedImport;\n                        }\n                        let [missingPackageName, ...deepPackagePathParts] = spec.split('/');\n                        if (missingPackageName.startsWith('@')) {\n                            missingPackageName += '/' + deepPackagePathParts.shift();\n                        }\n                        messageBus.emit('MISSING_WEB_MODULE', {\n                            id: f,\n                            data: {\n                                spec: spec,\n                                pkgName: missingPackageName,\n                            },\n                        });\n                        return path.posix.join(config.buildOptions.baseUrl, webModulesLoc, `${spec}.js`);\n                    });\n                    code = wrapImportMeta({ code, env: true, hmr: false, config });\n                }\n                await fs.mkdir(path.dirname(outPath), { recursive: true });\n                await fs.writeFile(outPath, code);\n                allBuiltFromFiles.add(f);\n            }\n        }\n        messageBus.emit('WORKER_COMPLETE', { id, error: null });\n    }\n    stopEsbuild();\n    for (const proxiedFileLoc of allCssModules) {\n        const proxiedCode = await fs.readFile(proxiedFileLoc, { encoding: 'utf8' });\n        const proxiedExt = path.extname(proxiedFileLoc);\n        const proxiedUrl = proxiedFileLoc.substr(buildDirectoryLoc.length);\n        const proxyCode = await wrapCssModuleResponse({\n            url: proxiedUrl,\n            code: proxiedCode,\n            ext: proxiedExt,\n            config,\n        });\n        const proxyFileLoc = proxiedFileLoc.replace('.module.css', '.css.module.js');\n        await fs.writeFile(proxyFileLoc, proxyCode, { encoding: 'utf8' });\n    }\n    for (const proxiedFileLoc of allProxiedFiles) {\n        const proxiedCode = await fs.readFile(proxiedFileLoc, { encoding: 'utf8' });\n        const proxiedExt = path.extname(proxiedFileLoc);\n        const proxiedUrl = proxiedFileLoc.substr(buildDirectoryLoc.length);\n        const proxyCode = wrapEsmProxyResponse({\n            url: proxiedUrl,\n            code: proxiedCode,\n            ext: proxiedExt,\n            config,\n        });\n        const proxyFileLoc = proxiedFileLoc + '.proxy.js';\n        await fs.writeFile(proxyFileLoc, proxyCode, { encoding: 'utf8' });\n    }\n    if (!isBundled) {\n        messageBus.emit('WORKER_COMPLETE', { id: bundleWorker.id, error: null });\n        messageBus.emit('WORKER_UPDATE', {\n            id: bundleWorker.id,\n            state: ['SKIP', isBundledHardcoded ? 'dim' : 'yellow'],\n        });\n        if (!isBundledHardcoded) {\n            messageBus.emit('WORKER_MSG', {\n                id: bundleWorker.id,\n                level: 'log',\n                msg: `\"plugins\": [\"@snowpack/plugin-webpack\"]\\n\\n` +\n                    `Connect a bundler plugin to optimize your build for production.\\n` +\n                    chalk.dim(`Set \"devOptions.bundle\" configuration to false to remove this message.`),\n            });\n        }\n    }\n    else {\n        try {\n            messageBus.emit('WORKER_UPDATE', { id: bundleWorker.id, state: ['RUNNING', 'yellow'] });\n            await bundleWorker?.plugin.bundle({\n                srcDirectory: buildDirectoryLoc,\n                destDirectory: finalDirectoryLoc,\n                jsFilePaths: allBuiltFromFiles,\n                log: (msg) => {\n                    messageBus.emit('WORKER_MSG', { id: bundleWorker.id, level: 'log', msg });\n                },\n            });\n            messageBus.emit('WORKER_COMPLETE', { id: bundleWorker.id, error: null });\n        }\n        catch (err) {\n            messageBus.emit('WORKER_MSG', {\n                id: bundleWorker.id,\n                level: 'error',\n                msg: err.toString(),\n            });\n            messageBus.emit('WORKER_COMPLETE', { id: bundleWorker.id, error: err });\n        }\n    }\n    if (finalDirectoryLoc !== buildDirectoryLoc) {\n        rimraf.sync(buildDirectoryLoc);\n    }\n}\n","import WebSocket from 'ws';\nexport class EsmHmrEngine {\n    constructor(options = {}) {\n        this.clients = new Set();\n        this.dependencyTree = new Map();\n        const wss = options.server\n            ? new WebSocket.Server({ noServer: true })\n            : new WebSocket.Server({ port: 12321 });\n        if (options.server) {\n            options.server.on('upgrade', (req, socket, head) => {\n                // Only handle upgrades to ESM-HMR requests, ignore others.\n                if (req.headers['sec-websocket-protocol'] !== 'esm-hmr') {\n                    return;\n                }\n                wss.handleUpgrade(req, socket, head, (client) => {\n                    wss.emit('connection', client, req);\n                });\n            });\n        }\n        wss.on('connection', (client) => {\n            this.connectClient(client);\n            this.registerListener(client);\n        });\n    }\n    registerListener(client) {\n        client.on('message', (data) => {\n            const message = JSON.parse(data.toString());\n            if (message.type === 'hotAccept') {\n                const entry = this.getEntry(message.id, true);\n                entry.isHmrAccepted = true;\n                entry.isHmrEnabled = true;\n            }\n        });\n    }\n    createEntry(sourceUrl) {\n        const newEntry = {\n            dependencies: new Set(),\n            dependents: new Set(),\n            needsReplacement: false,\n            isHmrEnabled: false,\n            isHmrAccepted: false,\n        };\n        this.dependencyTree.set(sourceUrl, newEntry);\n        return newEntry;\n    }\n    getEntry(sourceUrl, createIfNotFound = false) {\n        const result = this.dependencyTree.get(sourceUrl);\n        if (result) {\n            return result;\n        }\n        if (createIfNotFound) {\n            return this.createEntry(sourceUrl);\n        }\n        return null;\n    }\n    setEntry(sourceUrl, imports, isHmrEnabled = false) {\n        const result = this.getEntry(sourceUrl, true);\n        const outdatedDependencies = new Set(result.dependencies);\n        result.isHmrEnabled = isHmrEnabled;\n        for (const importUrl of imports) {\n            this.addRelationship(sourceUrl, importUrl);\n            outdatedDependencies.delete(importUrl);\n        }\n        for (const importUrl of outdatedDependencies) {\n            this.removeRelationship(sourceUrl, importUrl);\n        }\n    }\n    removeRelationship(sourceUrl, importUrl) {\n        let importResult = this.getEntry(importUrl);\n        importResult && importResult.dependents.delete(sourceUrl);\n        const sourceResult = this.getEntry(sourceUrl);\n        sourceResult && sourceResult.dependencies.delete(importUrl);\n    }\n    addRelationship(sourceUrl, importUrl) {\n        if (importUrl !== sourceUrl) {\n            let importResult = this.getEntry(importUrl, true);\n            importResult.dependents.add(sourceUrl);\n            const sourceResult = this.getEntry(sourceUrl, true);\n            sourceResult.dependencies.add(importUrl);\n        }\n    }\n    markEntryForReplacement(entry, state) {\n        entry.needsReplacement = state;\n    }\n    broadcastMessage(data) {\n        this.clients.forEach((client) => {\n            if (client.readyState === WebSocket.OPEN) {\n                client.send(JSON.stringify(data));\n            }\n            else {\n                this.disconnectClient(client);\n            }\n        });\n    }\n    connectClient(client) {\n        this.clients.add(client);\n    }\n    disconnectClient(client) {\n        client.terminate();\n        this.clients.delete(client);\n    }\n    disconnectAllClients() {\n        for (const client of this.clients) {\n            this.disconnectClient(client);\n        }\n    }\n}\n","/**\n * This license applies to parts of this file originating from the\n * https://github.com/lukejacksonn/servor repository:\n *\n * MIT License\n * Copyright (c) 2019 Luke Jackson\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\nimport cacache from 'cacache';\nimport chalk from 'chalk';\nimport isCompressible from 'compressible';\nimport { all as merge } from 'deepmerge';\nimport etag from 'etag';\nimport { EventEmitter } from 'events';\nimport execa from 'execa';\nimport { existsSync, promises as fs, readFileSync } from 'fs';\nimport http from 'http';\nimport http2 from 'http2';\nimport HttpProxy from 'http-proxy';\nimport mime from 'mime-types';\nimport npmRunPath from 'npm-run-path';\nimport os from 'os';\nimport path from 'path';\nimport onProcessExit from 'signal-exit';\nimport stream from 'stream';\nimport url from 'url';\nimport zlib from 'zlib';\nimport { EsmHmrEngine } from '../hmr-server-engine';\nimport { scanCodeImportsExports, transformEsmImports } from '../rewrite-imports';\nimport { BUILD_CACHE, checkLockfileHash, DEV_DEPENDENCIES_DIR, isYarn, openInBrowser, resolveDependencyManifest, findMatchingMountScript, updateLockfileHash, } from '../util';\nimport { getFileBuilderForWorker, isDirectoryImport, wrapCssModuleResponse, wrapEsmProxyResponse, wrapHtmlResponse, wrapImportMeta, generateEnvModule, } from './build-util';\nimport { command as installCommand } from './install';\nimport { paint, getPort } from './paint';\nimport srcFileExtensionMapping from './src-file-extension-mapping';\nconst HMR_DEV_CODE = readFileSync(path.join(__dirname, '../assets/hmr.js'));\nconst DEFAULT_PROXY_ERROR_HANDLER = (err, req, res) => {\n    const reqUrl = req.url;\n    console.error(`✘ ${reqUrl}\\n${err.message}`);\n    sendError(res, 502);\n};\nfunction shouldProxy(pathPrefix, req) {\n    const reqPath = decodeURI(url.parse(req.url).pathname);\n    return reqPath.startsWith(pathPrefix);\n}\nfunction getEncodingType(ext) {\n    if (ext === '.js' || ext === '.css' || ext === '.html' || ext === '.json') {\n        return 'utf-8';\n    }\n    else {\n        return 'binary';\n    }\n}\n/** Find disk location from specifier string */\nfunction getPackageNameFromSpecifier(specifier) {\n    let [packageName, ...deepPackagePathParts] = specifier.split('/');\n    if (packageName.startsWith('@')) {\n        packageName += '/' + deepPackagePathParts.shift();\n    }\n    return packageName;\n}\nconst sendFile = (req, res, body, ext = '.html') => {\n    const ETag = etag(body, { weak: true });\n    const headers = {\n        'Content-Type': mime.contentType(ext) || 'application/octet-stream',\n        'Access-Control-Allow-Origin': '*',\n        ETag,\n        Vary: 'Accept-Encoding',\n    };\n    if (req.headers['if-none-match'] === ETag) {\n        res.writeHead(304, headers);\n        res.end();\n        return;\n    }\n    let acceptEncoding = req.headers['accept-encoding'] || '';\n    if (req.headers['cache-control']?.includes('no-transform') ||\n        ['HEAD', 'OPTIONS'].includes(req.method) ||\n        !isCompressible(mime.contentType(ext))) {\n        acceptEncoding = '';\n    }\n    function onError(err) {\n        if (err) {\n            res.end();\n            console.error(chalk.red(`  ✘ An error occurred while compressing ${chalk.bold(req.url)}`), err);\n        }\n    }\n    if (/\\bgzip\\b/.test(acceptEncoding) && stream.Readable.from) {\n        const bodyStream = stream.Readable.from([body]);\n        headers['Content-Encoding'] = 'gzip';\n        res.writeHead(200, headers);\n        stream.pipeline(bodyStream, zlib.createGzip(), res, onError);\n        return;\n    }\n    res.writeHead(200, headers);\n    res.write(body, getEncodingType(ext));\n    res.end();\n};\nconst sendError = (res, status) => {\n    res.writeHead(status);\n    res.end();\n};\nfunction getUrlFromFile(mountedDirectories, fileLoc, extensionMapping) {\n    for (const [dirDisk, dirUrl] of mountedDirectories) {\n        if (fileLoc.startsWith(dirDisk + path.sep)) {\n            const fileExt = path.extname(fileLoc).substr(1);\n            const resolvedDirUrl = dirUrl === '/' ? '' : dirUrl;\n            return fileLoc\n                .replace(dirDisk, resolvedDirUrl)\n                .replace(/[/\\\\]+/g, '/')\n                .replace(new RegExp(`${fileExt}$`), extensionMapping[fileExt] || fileExt);\n        }\n    }\n    return null;\n}\nfunction getMountedDirectory(cwd, workerConfig) {\n    const { args } = workerConfig;\n    return [path.resolve(cwd, args.fromDisk), args.toUrl];\n}\nlet currentlyRunningCommand = null;\nexport async function command(commandOptions) {\n    const { cwd, config } = commandOptions;\n    const { port: defaultPort, open, hmr: isHmr } = config.devOptions;\n    let serverStart = Date.now();\n    const port = await getPort(defaultPort);\n    // Reset the clock if we had to wait for the user to select a new port.\n    if (port !== defaultPort) {\n        serverStart = Date.now();\n    }\n    const configSrcFileExtensionMapping = merge([\n        {},\n        srcFileExtensionMapping,\n        config.extensionMap || {},\n    ]);\n    const inMemoryBuildCache = new Map();\n    const inMemoryResourceCache = new Map();\n    const filesBeingDeleted = new Set();\n    const filesBeingBuilt = new Map();\n    const messageBus = new EventEmitter();\n    const mountedDirectories = [];\n    console.log = (...args) => {\n        messageBus.emit('CONSOLE', { level: 'log', args });\n    };\n    console.warn = (...args) => {\n        messageBus.emit('CONSOLE', { level: 'warn', args });\n    };\n    console.error = (...args) => {\n        messageBus.emit('CONSOLE', { level: 'error', args });\n    };\n    // Start painting immediately, so we can surface errors & warnings to the\n    // user, and they can watch the server starting up. Search for ”SERVER_START”\n    // for the actual start event below.\n    paint(messageBus, config.scripts, undefined, {\n        addPackage: async (pkgName) => {\n            isLiveReloadPaused = true;\n            messageBus.emit('INSTALLING');\n            currentlyRunningCommand = execa(isYarn(cwd) ? 'yarn' : 'npm', isYarn(cwd) ? ['add', pkgName] : ['install', '--save', pkgName], {\n                env: npmRunPath.env(),\n                extendEnv: true,\n                shell: true,\n                cwd,\n            });\n            currentlyRunningCommand.stdout.on('data', (data) => process.stdout.write(data));\n            currentlyRunningCommand.stderr.on('data', (data) => process.stderr.write(data));\n            await currentlyRunningCommand;\n            currentlyRunningCommand = installCommand(commandOptions);\n            await currentlyRunningCommand;\n            await updateLockfileHash(DEV_DEPENDENCIES_DIR);\n            await cacache.rm.all(BUILD_CACHE);\n            inMemoryBuildCache.clear();\n            currentlyRunningCommand = null;\n            dependencyImportMap = JSON.parse(await fs\n                .readFile(dependencyImportMapLoc, { encoding: 'utf-8' })\n                .catch(() => `{\"imports\": {}}`));\n            messageBus.emit('INSTALL_COMPLETE');\n            isLiveReloadPaused = false;\n        },\n    });\n    // Set the proper install options, in case an install is needed.\n    commandOptions.config.installOptions.dest = DEV_DEPENDENCIES_DIR;\n    commandOptions.config.installOptions.env.NODE_ENV = process.env.NODE_ENV || 'development';\n    const dependencyImportMapLoc = path.join(config.installOptions.dest, 'import-map.json');\n    // Start with a fresh install of your dependencies, if needed.\n    if (!(await checkLockfileHash(DEV_DEPENDENCIES_DIR)) || !existsSync(dependencyImportMapLoc)) {\n        console.log(chalk.yellow('! updating dependencies...'));\n        await installCommand(commandOptions);\n        await updateLockfileHash(DEV_DEPENDENCIES_DIR);\n    }\n    let dependencyImportMap = { imports: {} };\n    try {\n        dependencyImportMap = JSON.parse(await fs.readFile(dependencyImportMapLoc, { encoding: 'utf-8' }));\n    }\n    catch (err) {\n        // no import-map found, safe to ignore\n    }\n    /** Rerun `snowpack install` while dev server is running */\n    async function reinstallDependencies() {\n        if (!currentlyRunningCommand) {\n            isLiveReloadPaused = true;\n            messageBus.emit('INSTALLING');\n            currentlyRunningCommand = installCommand(commandOptions);\n            await currentlyRunningCommand.then(async () => {\n                dependencyImportMap = JSON.parse(await fs\n                    .readFile(dependencyImportMapLoc, { encoding: 'utf-8' })\n                    .catch(() => `{\"imports\": {}}`));\n                await updateLockfileHash(DEV_DEPENDENCIES_DIR);\n                await cacache.rm.all(BUILD_CACHE);\n                inMemoryBuildCache.clear();\n                messageBus.emit('INSTALL_COMPLETE');\n                isLiveReloadPaused = false;\n                currentlyRunningCommand = null;\n            });\n        }\n    }\n    async function buildFile(fileContents, fileLoc, reqPath, fileBuilder) {\n        let builtFileResult;\n        let fileBuilderPromise = filesBeingBuilt.get(fileLoc);\n        if (fileBuilderPromise) {\n            builtFileResult = await fileBuilderPromise;\n        }\n        else {\n            fileBuilderPromise = (async () => {\n                let _builtFileResult = { result: fileContents };\n                if (fileBuilder) {\n                    _builtFileResult =\n                        (await fileBuilder({\n                            contents: fileContents,\n                            filePath: fileLoc,\n                            isDev: true,\n                        })) || _builtFileResult;\n                }\n                for (const plugin of config.plugins) {\n                    if (plugin.transform) {\n                        _builtFileResult.result =\n                            (await plugin.transform({\n                                contents: _builtFileResult.result,\n                                urlPath: reqPath,\n                                isDev: true,\n                            }))?.result || _builtFileResult.result;\n                    }\n                }\n                return _builtFileResult;\n            })();\n            try {\n                filesBeingBuilt.set(fileLoc, fileBuilderPromise);\n                builtFileResult = await fileBuilderPromise;\n            }\n            finally {\n                filesBeingBuilt.delete(fileLoc);\n            }\n        }\n        const webModulesScript = config.scripts.find((script) => script.id === 'mount:web_modules');\n        const webModulesLoc = webModulesScript ? webModulesScript.args.toUrl : '/web_modules';\n        const ext = path.extname(fileLoc).substr(1);\n        if (ext === 'js' || configSrcFileExtensionMapping[ext] === 'js') {\n            let missingWebModule = null;\n            builtFileResult.result = await transformEsmImports(builtFileResult.result, (spec) => {\n                if (spec.startsWith('http')) {\n                    return spec;\n                }\n                let mountScript = findMatchingMountScript(config.scripts, spec);\n                if (mountScript) {\n                    let { fromDisk, toUrl } = mountScript.args;\n                    spec = spec.replace(fromDisk, toUrl);\n                }\n                if (spec.startsWith('/') || spec.startsWith('./') || spec.startsWith('../')) {\n                    const ext = path.extname(spec).substr(1);\n                    if (!ext) {\n                        if (isDirectoryImport(fileLoc, spec)) {\n                            return spec + '/index.js';\n                        }\n                        else {\n                            return spec + '.js';\n                        }\n                    }\n                    const extToReplace = configSrcFileExtensionMapping[ext];\n                    if (extToReplace) {\n                        spec = spec.replace(new RegExp(`${ext}$`), extToReplace);\n                    }\n                    if (!spec.endsWith('.module.css') && (extToReplace || ext) !== 'js') {\n                        spec = spec + '.proxy.js';\n                    }\n                    return spec;\n                }\n                if (dependencyImportMap.imports[spec]) {\n                    let resolvedImport = path.posix.resolve(webModulesLoc, dependencyImportMap.imports[spec]);\n                    const extName = path.extname(resolvedImport);\n                    if (extName && extName !== '.js') {\n                        resolvedImport = resolvedImport + '.proxy.js';\n                    }\n                    return resolvedImport;\n                }\n                const packageName = getPackageNameFromSpecifier(spec);\n                const [depManifestLoc] = resolveDependencyManifest(packageName, cwd);\n                const doesPackageExist = !!depManifestLoc;\n                if (doesPackageExist) {\n                    reinstallDependencies();\n                }\n                else {\n                    missingWebModule = {\n                        spec: spec,\n                        pkgName: packageName,\n                    };\n                }\n                const extName = path.extname(spec);\n                if (extName && extName !== '.js') {\n                    spec = spec + '.proxy';\n                }\n                return path.posix.join(webModulesLoc, `${spec}.js`);\n            });\n            messageBus.emit('MISSING_WEB_MODULE', {\n                id: fileLoc,\n                data: missingWebModule,\n            });\n        }\n        return builtFileResult;\n    }\n    function runLintAll(workerConfig) {\n        let { id, cmd, watch: watchCmd } = workerConfig;\n        const workerPromise = execa.command(watchCmd || cmd, {\n            env: npmRunPath.env(),\n            extendEnv: true,\n            shell: true,\n            cwd,\n        });\n        const { stdout, stderr } = workerPromise;\n        stdout?.on('data', (b) => {\n            let stdOutput = b.toString();\n            if (stdOutput.includes('\\u001bc') || stdOutput.includes('\\x1Bc')) {\n                messageBus.emit('WORKER_RESET', { id });\n                stdOutput = stdOutput.replace(/\\x1Bc/, '').replace(/\\u001bc/, '');\n            }\n            if (id.endsWith(':tsc')) {\n                if (stdOutput.includes('\\u001bc') || stdOutput.includes('\\x1Bc')) {\n                    messageBus.emit('WORKER_UPDATE', { id, state: ['RUNNING', 'yellow'] });\n                }\n                if (/Watching for file changes./gm.test(stdOutput)) {\n                    messageBus.emit('WORKER_UPDATE', { id, state: 'WATCH' });\n                }\n                const errorMatch = stdOutput.match(/Found (\\d+) error/);\n                if (errorMatch && errorMatch[1] !== '0') {\n                    messageBus.emit('WORKER_UPDATE', { id, state: ['ERROR', 'red'] });\n                }\n            }\n            messageBus.emit('WORKER_MSG', { id, level: 'log', msg: stdOutput });\n        });\n        stderr?.on('data', (b) => {\n            messageBus.emit('WORKER_MSG', { id, level: 'error', msg: b.toString() });\n        });\n        workerPromise.catch((err) => {\n            messageBus.emit('WORKER_COMPLETE', { id, error: err });\n        });\n        workerPromise.then(() => {\n            messageBus.emit('WORKER_COMPLETE', { id, error: null });\n        });\n    }\n    for (const workerConfig of config.scripts) {\n        if (workerConfig.type === 'run') {\n            runLintAll(workerConfig);\n        }\n        if (workerConfig.type === 'mount') {\n            mountedDirectories.push(getMountedDirectory(cwd, workerConfig));\n            setTimeout(() => messageBus.emit('WORKER_UPDATE', { id: workerConfig.id, state: ['DONE', 'green'] }), 400);\n        }\n    }\n    const devProxies = {};\n    config.proxy.forEach(([pathPrefix, proxyOptions]) => {\n        const proxyServer = (devProxies[pathPrefix] = HttpProxy.createProxyServer(proxyOptions));\n        for (const [onEventName, eventHandler] of Object.entries(proxyOptions.on)) {\n            proxyServer.on(onEventName, eventHandler);\n        }\n        if (!proxyOptions.on.error) {\n            proxyServer.on('error', DEFAULT_PROXY_ERROR_HANDLER);\n        }\n    });\n    const readCredentials = async (cwd) => {\n        const [cert, key] = await Promise.all([\n            fs.readFile(path.join(cwd, 'snowpack.crt')),\n            fs.readFile(path.join(cwd, 'snowpack.key')),\n        ]);\n        return {\n            cert,\n            key,\n        };\n    };\n    let credentials;\n    if (config.devOptions.secure) {\n        try {\n            credentials = await readCredentials(cwd);\n        }\n        catch (e) {\n            console.error(chalk.red(`✘ No HTTPS credentials found! Missing Files:  ${chalk.bold('snowpack.crt')}, ${chalk.bold('snowpack.key')}`));\n            console.log();\n            console.log('You can automatically generate credentials for your project via either:');\n            console.log();\n            console.log(`  - ${chalk.cyan('devcert')}: ${chalk.yellow('npx devcert-cli generate localhost')}`);\n            console.log('    https://github.com/davewasmer/devcert-cli (no install required)');\n            console.log();\n            console.log(`  - ${chalk.cyan('mkcert')}: ${chalk.yellow('mkcert -install && mkcert -key-file snowpack.key -cert-file snowpack.crt localhost')}`);\n            console.log('    https://github.com/FiloSottile/mkcert (install required)');\n            console.log();\n            process.exit(1);\n        }\n    }\n    async function requestHandler(req, res) {\n        const reqUrl = req.url;\n        const reqUrlHmrParam = reqUrl.includes('?mtime=') && reqUrl.split('?')[1];\n        let reqPath = decodeURI(url.parse(reqUrl).pathname);\n        const originalReqPath = reqPath;\n        let isProxyModule = false;\n        let isCssModule = false;\n        if (reqPath.endsWith('.proxy.js')) {\n            isProxyModule = true;\n            reqPath = reqPath.replace('.proxy.js', '');\n        }\n        if (reqPath.endsWith('.module.css')) {\n            isCssModule = true;\n        }\n        // const requestStart = Date.now();\n        res.on('finish', () => {\n            const { method, url } = req;\n            const { statusCode } = res;\n            if (statusCode !== 200) {\n                messageBus.emit('SERVER_RESPONSE', {\n                    method,\n                    url,\n                    statusCode,\n                });\n            }\n        });\n        if (reqPath === `/${config.buildOptions.metaDir}/hmr.js`) {\n            sendFile(req, res, HMR_DEV_CODE, '.js');\n            return;\n        }\n        if (reqPath === `/${config.buildOptions.metaDir}/env.js`) {\n            sendFile(req, res, generateEnvModule('development'), '.js');\n            return;\n        }\n        for (const [pathPrefix] of config.proxy) {\n            if (!shouldProxy(pathPrefix, req)) {\n                continue;\n            }\n            devProxies[pathPrefix].web(req, res);\n            return;\n        }\n        const attemptedFileLoads = [];\n        function attemptLoadFile(requestedFile) {\n            if (attemptedFileLoads.includes(requestedFile)) {\n                return Promise.resolve(null);\n            }\n            attemptedFileLoads.push(requestedFile);\n            return fs\n                .stat(requestedFile)\n                .then((stat) => (stat.isFile() ? requestedFile : null))\n                .catch(() => null /* ignore */);\n        }\n        let requestedFileExt = path.parse(reqPath).ext.toLowerCase();\n        let responseFileExt = requestedFileExt;\n        let fileBuilder;\n        let isRoute = !requestedFileExt;\n        // Now that we've set isRoute properly, give `requestedFileExt` a fallback\n        requestedFileExt = requestedFileExt || '.html';\n        async function getFileFromUrl(reqPath) {\n            for (const [dirDisk, dirUrl] of mountedDirectories) {\n                let requestedFile;\n                if (dirUrl === '/') {\n                    requestedFile = path.join(dirDisk, reqPath);\n                }\n                else if (reqPath.startsWith(dirUrl)) {\n                    requestedFile = path.join(dirDisk, reqPath.replace(dirUrl, './'));\n                }\n                else {\n                    continue;\n                }\n                if (requestedFile.startsWith(commandOptions.config.installOptions.dest)) {\n                    const fileLoc = await attemptLoadFile(requestedFile);\n                    if (fileLoc) {\n                        return [fileLoc, null];\n                    }\n                }\n                if (isRoute) {\n                    let fileLoc = (await attemptLoadFile(requestedFile + '.html')) ||\n                        (await attemptLoadFile(requestedFile + 'index.html')) ||\n                        (await attemptLoadFile(requestedFile + '/index.html'));\n                    if (!fileLoc && dirUrl === '/' && config.devOptions.fallback) {\n                        const fallbackFile = path.join(dirDisk, config.devOptions.fallback);\n                        fileLoc = await attemptLoadFile(fallbackFile);\n                    }\n                    if (fileLoc) {\n                        responseFileExt = '.html';\n                        return [fileLoc, null];\n                    }\n                }\n                else {\n                    for (const workerConfig of config.scripts) {\n                        const { type, match } = workerConfig;\n                        if (type !== 'build') {\n                            continue;\n                        }\n                        for (const extMatcher of match) {\n                            if (extMatcher === requestedFileExt.substr(1) ||\n                                configSrcFileExtensionMapping[extMatcher] === requestedFileExt.substr(1)) {\n                                const srcFile = requestedFile.replace(requestedFileExt, `.${extMatcher}`);\n                                const fileLoc = await attemptLoadFile(srcFile);\n                                if (fileLoc) {\n                                    return [fileLoc, workerConfig];\n                                }\n                            }\n                        }\n                    }\n                    const fileLoc = (await attemptLoadFile(requestedFile)) ||\n                        (await attemptLoadFile(requestedFile.replace(/\\.js$/, '.jsx'))) ||\n                        (await attemptLoadFile(requestedFile.replace(/\\.js$/, '.ts'))) ||\n                        (await attemptLoadFile(requestedFile.replace(/\\.js$/, '.tsx')));\n                    if (fileLoc) {\n                        return [fileLoc, null];\n                    }\n                }\n            }\n            return [null, null];\n        }\n        // 0. Check if the request is for a virtual sub-resource. These are populated by some\n        // builders when a file compiles to multiple files. For example, Svelte & Vue files\n        // compile to a main JS file + related CSS to import with the JS.\n        let virtualResourceResponse = inMemoryResourceCache.get(reqPath);\n        if (virtualResourceResponse) {\n            if (isProxyModule) {\n                responseFileExt = '.js';\n                virtualResourceResponse = wrapEsmProxyResponse({\n                    url: reqPath,\n                    code: virtualResourceResponse,\n                    ext: requestedFileExt,\n                    hasHmr: true,\n                    config,\n                });\n            }\n            sendFile(req, res, virtualResourceResponse, responseFileExt);\n            return;\n        }\n        const [fileLoc, selectedWorker] = await getFileFromUrl(reqPath);\n        if (isRoute) {\n            messageBus.emit('NEW_SESSION');\n        }\n        if (!fileLoc) {\n            const prefix = chalk.red('  ✘ ');\n            console.error(`[404] ${reqUrl}\\n${attemptedFileLoads.map((loc) => prefix + loc).join('\\n')}`);\n            return sendError(res, 404);\n        }\n        if (selectedWorker) {\n            fileBuilder = getFileBuilderForWorker(cwd, selectedWorker, messageBus);\n        }\n        async function wrapResponse(code, cssResource) {\n            if (isRoute) {\n                code = wrapHtmlResponse({ code: code, hasHmr: isHmr, buildOptions: config.buildOptions });\n            }\n            else if (isProxyModule) {\n                responseFileExt = '.js';\n                code = wrapEsmProxyResponse({\n                    url: reqPath,\n                    code,\n                    ext: requestedFileExt,\n                    hasHmr: isHmr,\n                    config,\n                });\n            }\n            else if (isCssModule) {\n                responseFileExt = '.js';\n                code = await wrapCssModuleResponse({\n                    url: reqPath,\n                    code,\n                    ext: requestedFileExt,\n                    hasHmr: isHmr,\n                    config,\n                });\n            }\n            else if (responseFileExt === '.js') {\n                code = wrapImportMeta({ code, env: true, hmr: isHmr, config });\n            }\n            if (responseFileExt === '.js' && cssResource) {\n                code = `import './${path.basename(reqPath).replace(/.js$/, '.css.proxy.js')}';\\n` + code;\n            }\n            if (responseFileExt === '.js' && reqUrlHmrParam) {\n                code = await transformEsmImports(code, (imp) => {\n                    const importUrl = path.posix.resolve(path.posix.dirname(reqPath), imp);\n                    const node = hmrEngine.getEntry(importUrl);\n                    if (node && node.needsReplacement) {\n                        hmrEngine.markEntryForReplacement(node, false);\n                        return `${imp}?${reqUrlHmrParam}`;\n                    }\n                    return imp;\n                });\n            }\n            return code;\n        }\n        // 1. Check the hot build cache. If it's already found, then just serve it.\n        let hotCachedResponse = inMemoryBuildCache.get(fileLoc);\n        if (hotCachedResponse) {\n            hotCachedResponse = hotCachedResponse.toString(getEncodingType(requestedFileExt));\n            const wrappedResponse = await wrapResponse(hotCachedResponse, inMemoryResourceCache.get(reqPath.replace(/.js$/, '.css')));\n            sendFile(req, res, wrappedResponse, responseFileExt);\n            return;\n        }\n        // 2. Load the file from disk. We'll need it to check the cold cache or build from scratch.\n        const fileContents = await fs.readFile(fileLoc, getEncodingType(requestedFileExt));\n        // 3. Check the persistent cache. If found, serve it via a \"trust-but-verify\" strategy.\n        // Build it after sending, and if it no longer matches then assume the entire cache is suspect.\n        // In that case, clear the persistent cache and then force a live-reload of the page.\n        const cachedBuildData = !filesBeingDeleted.has(fileLoc) &&\n            (await cacache.get(BUILD_CACHE, fileLoc).catch(() => null));\n        if (cachedBuildData) {\n            const { originalFileHash, resources } = cachedBuildData.metadata;\n            const newFileHash = etag(fileContents);\n            if (originalFileHash === newFileHash) {\n                const coldCachedResponse = cachedBuildData.data;\n                inMemoryBuildCache.set(fileLoc, coldCachedResponse);\n                if (resources?.css) {\n                    inMemoryResourceCache.set(reqPath.replace(/.js$/, '.css'), resources.css);\n                }\n                // Trust...\n                const wrappedResponse = await wrapResponse(coldCachedResponse.toString(getEncodingType(requestedFileExt)), resources?.css);\n                if (responseFileExt === '.js') {\n                    const isHmrEnabled = wrappedResponse.includes('import.meta.hot');\n                    const rawImports = await scanCodeImportsExports(wrappedResponse);\n                    const resolvedImports = rawImports.map((imp) => {\n                        let spec = wrappedResponse.substring(imp.s, imp.e);\n                        if (imp.d > -1) {\n                            const importSpecifierMatch = spec.match(/^\\s*['\"](.*)['\"]\\s*$/m);\n                            spec = importSpecifierMatch[1];\n                        }\n                        return path.posix.resolve(path.posix.dirname(reqPath), spec);\n                    });\n                    hmrEngine.setEntry(originalReqPath, resolvedImports, isHmrEnabled);\n                }\n                sendFile(req, res, wrappedResponse, responseFileExt);\n                // ...but verify.\n                let checkFinalBuildResult = null;\n                let checkFinalBuildCss = null;\n                try {\n                    const checkFinalBuildAnyway = await buildFile(fileContents, fileLoc, reqPath, fileBuilder);\n                    checkFinalBuildResult = checkFinalBuildAnyway && checkFinalBuildAnyway.result;\n                    checkFinalBuildCss = checkFinalBuildAnyway && checkFinalBuildAnyway.resources?.css;\n                }\n                catch (err) {\n                    // safe to ignore, it will be surfaced later anyway\n                }\n                finally {\n                    if (checkFinalBuildCss !== resources?.css ||\n                        !checkFinalBuildResult ||\n                        !coldCachedResponse.equals(Buffer.from(checkFinalBuildResult, getEncodingType(requestedFileExt)))) {\n                        inMemoryBuildCache.clear();\n                        await cacache.rm.all(BUILD_CACHE);\n                        hmrEngine.broadcastMessage({ type: 'reload' });\n                    }\n                }\n                return;\n            }\n        }\n        // 4. Final option: build the file, serve it, and cache it.\n        let finalBuild;\n        try {\n            finalBuild = await buildFile(fileContents, fileLoc, reqPath, fileBuilder);\n        }\n        catch (err) {\n            console.error(fileLoc, err);\n        }\n        if (!finalBuild || finalBuild.result === '') {\n            return sendError(res, 500);\n        }\n        inMemoryBuildCache.set(fileLoc, Buffer.from(finalBuild.result, getEncodingType(requestedFileExt)));\n        if (finalBuild.resources?.css) {\n            inMemoryResourceCache.set(reqPath.replace(/.js$/, `.css`), finalBuild.resources.css);\n        }\n        const originalFileHash = etag(fileContents);\n        cacache.put(BUILD_CACHE, fileLoc, Buffer.from(finalBuild.result, getEncodingType(requestedFileExt)), { metadata: { originalFileHash, resources: finalBuild.resources } });\n        const wrappedResponse = await wrapResponse(finalBuild.result, finalBuild.resources?.css);\n        if (responseFileExt === '.js') {\n            const isHmrEnabled = wrappedResponse.includes('import.meta.hot');\n            const rawImports = await scanCodeImportsExports(wrappedResponse);\n            const resolvedImports = rawImports.map((imp) => {\n                let spec = wrappedResponse.substring(imp.s, imp.e);\n                if (imp.d > -1) {\n                    const importSpecifierMatch = spec.match(/^\\s*['\"](.*)['\"]\\s*$/m);\n                    spec = importSpecifierMatch[1];\n                }\n                return path.posix.resolve(path.posix.dirname(reqPath), spec);\n            });\n            hmrEngine.setEntry(originalReqPath, resolvedImports, isHmrEnabled);\n        }\n        sendFile(req, res, wrappedResponse, responseFileExt);\n    }\n    const createServer = credentials\n        ? (requestHandler) => http2.createSecureServer({ ...credentials, allowHTTP1: true }, requestHandler)\n        : (requestHandler) => http.createServer(requestHandler);\n    const server = createServer(async (req, res) => {\n        try {\n            return await requestHandler(req, res);\n        }\n        catch (err) {\n            console.error(`[500] ${req.url}`);\n            console.error(err);\n            return sendError(res, 500);\n        }\n    })\n        .on('error', (err) => {\n        console.error(chalk.red(`  ✘ Failed to start server at port ${chalk.bold(port)}.`), err);\n        server.close();\n        process.exit(1);\n    })\n        .on('upgrade', (req, socket, head) => {\n        config.proxy.forEach(([pathPrefix, proxyOptions]) => {\n            const isWebSocket = proxyOptions.ws || proxyOptions.target?.toString().startsWith('ws');\n            if (isWebSocket && shouldProxy(pathPrefix, req)) {\n                devProxies[pathPrefix].ws(req, socket, head);\n                console.log('Upgrading to WebSocket');\n            }\n        });\n    })\n        .listen(port);\n    const hmrEngine = new EsmHmrEngine({ server });\n    onProcessExit(() => {\n        hmrEngine.disconnectAllClients();\n    });\n    // Live Reload + File System Watching\n    let isLiveReloadPaused = false;\n    function updateOrBubble(url, visited) {\n        if (visited.has(url)) {\n            return;\n        }\n        visited.add(url);\n        const node = hmrEngine.getEntry(url);\n        if (node && node.isHmrEnabled) {\n            hmrEngine.broadcastMessage({ type: 'update', url });\n        }\n        if (node && node.isHmrAccepted) {\n            // Found a boundary, no bubbling needed\n        }\n        else if (node && node.dependents.size > 0) {\n            hmrEngine.markEntryForReplacement(node, true);\n            node.dependents.forEach((dep) => updateOrBubble(dep, visited));\n        }\n        else {\n            // We've reached the top, trigger a full page refresh\n            hmrEngine.broadcastMessage({ type: 'reload' });\n        }\n    }\n    function handleHmrUpdate(fileLoc) {\n        if (isLiveReloadPaused) {\n            return;\n        }\n        let updateUrl = getUrlFromFile(mountedDirectories, fileLoc, configSrcFileExtensionMapping);\n        if (!updateUrl) {\n            return;\n        }\n        // HTML files don't support HMR, so just reload the current page.\n        if (updateUrl.endsWith('.html')) {\n            hmrEngine.broadcastMessage({ type: 'reload' });\n            return;\n        }\n        // Append \".proxy.js\" to Non-JS files to match their registered URL in the client app.\n        if (!updateUrl.endsWith('.js') && !updateUrl.endsWith('.module.css')) {\n            updateUrl += '.proxy.js';\n        }\n        // Check if a virtual file exists in the resource cache (ex: CSS from a Svelte file)\n        // If it does, mark it for HMR replacement but DONT trigger a separate HMR update event.\n        // This is because a virtual resource doesn't actually exist on disk, so we need the main\n        // resource (the JS) to load first. Only after that happens will the CSS exist.\n        const virtualCssFileUrl = updateUrl.replace(/.js$/, '.css');\n        const virtualNode = hmrEngine.getEntry(`${virtualCssFileUrl}.proxy.js`);\n        if (virtualNode && inMemoryResourceCache.has(virtualCssFileUrl)) {\n            inMemoryResourceCache.delete(virtualCssFileUrl);\n            hmrEngine.markEntryForReplacement(virtualNode, true);\n        }\n        // If the changed file exists on the page, trigger a new HMR update.\n        if (hmrEngine.getEntry(updateUrl)) {\n            updateOrBubble(updateUrl, new Set());\n        }\n    }\n    // Announce server has started\n    const ips = Object.values(os.networkInterfaces())\n        .reduce((every, i) => [...every, ...(i || [])], [])\n        .filter((i) => i.family === 'IPv4' && i.internal === false)\n        .map((i) => i.address);\n    const protocol = config.devOptions.secure ? 'https:' : 'http:';\n    messageBus.emit('SERVER_START', {\n        protocol,\n        port,\n        ips,\n        startTimeMs: Date.now() - serverStart,\n    });\n    // Open the user's browser\n    if (open !== 'none')\n        await openInBrowser(protocol, port, open);\n    // Start watching the file system.\n    // Defer \"chokidar\" loading to here, to reduce impact on overall startup time\n    const chokidar = await import('chokidar');\n    // Watch src files\n    async function onWatchEvent(fileLoc) {\n        handleHmrUpdate(fileLoc);\n        inMemoryBuildCache.delete(fileLoc);\n        filesBeingDeleted.add(fileLoc);\n        await cacache.rm.entry(BUILD_CACHE, fileLoc);\n        filesBeingDeleted.delete(fileLoc);\n    }\n    const watcher = chokidar.watch(mountedDirectories.map(([dirDisk]) => dirDisk), {\n        ignored: config.exclude,\n        persistent: true,\n        ignoreInitial: true,\n        disableGlobbing: false,\n    });\n    watcher.on('add', (fileLoc) => onWatchEvent(fileLoc));\n    watcher.on('change', (fileLoc) => onWatchEvent(fileLoc));\n    watcher.on('unlink', (fileLoc) => onWatchEvent(fileLoc));\n    // Watch node_modules & rerun snowpack install if symlinked dep updates\n    const symlinkedFileLocs = new Set(Object.keys(dependencyImportMap.imports)\n        .map((specifier) => {\n        const packageName = getPackageNameFromSpecifier(specifier);\n        return resolveDependencyManifest(packageName, cwd);\n    }) // resolve symlink src location\n        .filter(([_, packageManifest]) => packageManifest && !packageManifest['_id']) // only watch symlinked deps for now\n        .map(([fileLoc]) => `${path.dirname(fileLoc)}/**`));\n    function onDepWatchEvent() {\n        reinstallDependencies().then(() => hmrEngine.broadcastMessage({ type: 'reload' }));\n    }\n    const depWatcher = chokidar.watch([...symlinkedFileLocs], {\n        cwd: '/',\n        persistent: true,\n        ignoreInitial: true,\n        disableGlobbing: false,\n    });\n    depWatcher.on('add', onDepWatchEvent);\n    depWatcher.on('change', onDepWatchEvent);\n    depWatcher.on('unlink', onDepWatchEvent);\n    return new Promise(() => { });\n}\n","import { command as installCommand } from './install';\nimport got from 'got';\nimport path from 'path';\nimport { promises as fs } from 'fs';\nexport async function addCommand(addValue, commandOptions) {\n    const { cwd, config, pkgManifest } = commandOptions;\n    let [pkgName, pkgSemver] = addValue.split('@');\n    if (!pkgSemver) {\n        const body = (await got(`http://registry.npmjs.org/${pkgName}/latest`).json());\n        pkgSemver = `^${body.version}`;\n    }\n    pkgManifest.webDependencies = pkgManifest.webDependencies || {};\n    pkgManifest.webDependencies[pkgName] = pkgSemver;\n    config.webDependencies = config.webDependencies || {};\n    config.webDependencies[pkgName] = pkgSemver;\n    await fs.writeFile(path.join(cwd, 'package.json'), JSON.stringify(pkgManifest, null, 2));\n    await installCommand(commandOptions);\n}\nexport async function rmCommand(addValue, commandOptions) {\n    const { cwd, config, pkgManifest } = commandOptions;\n    let [pkgName] = addValue.split('@');\n    pkgManifest.webDependencies = pkgManifest.webDependencies || {};\n    delete pkgManifest.webDependencies[pkgName];\n    config.webDependencies = config.webDependencies || {};\n    delete config.webDependencies[pkgName];\n    await fs.writeFile(path.join(cwd, 'package.json'), JSON.stringify(pkgManifest, null, 2));\n    await installCommand(commandOptions);\n}\n","import chalk from 'chalk';\nimport { cosmiconfigSync } from 'cosmiconfig';\nimport { all as merge } from 'deepmerge';\nimport { validate } from 'jsonschema';\nimport path from 'path';\nimport yargs from 'yargs-parser';\nimport { esbuildPlugin } from './commands/esbuildPlugin';\nimport { BUILD_DEPENDENCIES_DIR, DEV_DEPENDENCIES_DIR } from './util';\nconst CONFIG_NAME = 'snowpack';\nconst ALWAYS_EXCLUDE = ['**/node_modules/**/*', '**/.types/**/*'];\nconst SCRIPT_TYPES_WEIGHTED = {\n    proxy: 1,\n    mount: 2,\n    run: 3,\n    build: 4,\n    bundle: 100,\n};\n// default settings\nconst DEFAULT_CONFIG = {\n    exclude: ['__tests__/**/*', '**/*.@(spec|test).*'],\n    plugins: [],\n    installOptions: {\n        dest: 'web_modules',\n        externalPackage: [],\n        installTypes: false,\n        env: {},\n        alias: {},\n        namedExports: [],\n        rollup: {\n            plugins: [],\n            dedupe: [],\n        },\n    },\n    devOptions: {\n        secure: false,\n        port: 8080,\n        open: 'default',\n        out: 'build',\n        fallback: 'index.html',\n        hmr: true,\n        bundle: undefined,\n    },\n    buildOptions: {\n        baseUrl: '/',\n        metaDir: '__snowpack__',\n    },\n};\nconst configSchema = {\n    type: 'object',\n    properties: {\n        extends: { type: 'string' },\n        install: { type: 'array', items: { type: 'string' } },\n        exclude: { type: 'array', items: { type: 'string' } },\n        plugins: { type: 'array' },\n        extensionMap: {\n            type: 'object',\n            additionalProperties: { type: 'string' },\n        },\n        webDependencies: {\n            type: ['object'],\n            additionalProperties: { type: 'string' },\n        },\n        scripts: {\n            type: ['object'],\n            additionalProperties: { type: 'string' },\n        },\n        devOptions: {\n            type: 'object',\n            properties: {\n                secure: { type: 'boolean' },\n                port: { type: 'number' },\n                out: { type: 'string' },\n                fallback: { type: 'string' },\n                bundle: { type: 'boolean' },\n                open: { type: 'string' },\n                hmr: { type: 'boolean' },\n            },\n        },\n        installOptions: {\n            type: 'object',\n            properties: {\n                dest: { type: 'string' },\n                externalPackage: { type: 'array', items: { type: 'string' } },\n                treeshake: { type: 'boolean' },\n                installTypes: { type: 'boolean' },\n                sourceMap: { oneOf: [{ type: 'boolean' }, { type: 'string' }] },\n                alias: {\n                    type: 'object',\n                    additionalProperties: { type: 'string' },\n                },\n                env: {\n                    type: 'object',\n                    additionalProperties: {\n                        oneOf: [\n                            { id: 'EnvVarString', type: 'string' },\n                            { id: 'EnvVarNumber', type: 'number' },\n                            { id: 'EnvVarTrue', type: 'boolean', enum: [true] },\n                        ],\n                    },\n                },\n                rollup: {\n                    type: 'object',\n                    properties: {\n                        plugins: { type: 'array', items: { type: 'object' } },\n                        dedupe: {\n                            type: 'array',\n                            items: { type: 'string' },\n                        },\n                    },\n                },\n            },\n        },\n        buildOptions: {\n            type: ['object'],\n            properties: {\n                baseUrl: { type: 'string' },\n                metaDir: { type: 'string' },\n            },\n        },\n        proxy: {\n            type: 'object',\n        },\n    },\n};\n/**\n * Convert CLI flags to an incomplete Snowpack config representation.\n * We need to be careful about setting properties here if the flag value\n * is undefined, since the deep merge strategy would then overwrite good\n * defaults with 'undefined'.\n */\nfunction expandCliFlags(flags) {\n    const result = {\n        installOptions: {},\n        devOptions: {},\n        buildOptions: {},\n    };\n    const { help, version, reload, config, ...relevantFlags } = flags;\n    for (const [flag, val] of Object.entries(relevantFlags)) {\n        if (flag === '_' || flag.includes('-')) {\n            continue;\n        }\n        if (configSchema.properties[flag]) {\n            result[flag] = val;\n            continue;\n        }\n        if (configSchema.properties.installOptions.properties[flag]) {\n            result.installOptions[flag] = val;\n            continue;\n        }\n        if (configSchema.properties.devOptions.properties[flag]) {\n            result.devOptions[flag] = val;\n            continue;\n        }\n        console.error(`Unknown CLI flag: \"${flag}\"`);\n        process.exit(1);\n    }\n    if (result.installOptions.env) {\n        result.installOptions.env = result.installOptions.env.reduce((acc, id) => {\n            const index = id.indexOf('=');\n            const [key, val] = index > 0 ? [id.substr(0, index), id.substr(index + 1)] : [id, true];\n            acc[key] = val;\n            return acc;\n        }, {});\n    }\n    return result;\n}\n/**\n * Convert deprecated proxy scripts to\n * FUTURE: Remove this on next major release\n */\nfunction handleLegacyProxyScripts(config) {\n    for (const scriptId in config.scripts) {\n        if (!scriptId.startsWith('proxy:')) {\n            continue;\n        }\n        const cmdArr = config.scripts[scriptId].split(/\\s+/);\n        if (cmdArr[0] !== 'proxy') {\n            handleConfigError(`scripts[${scriptId}] must use the proxy command`);\n        }\n        cmdArr.shift();\n        const { to, _ } = yargs(cmdArr);\n        if (_.length !== 1) {\n            handleConfigError(`scripts[${scriptId}] must use the format: \"proxy http://SOME.URL --to /PATH\"`);\n        }\n        if (to && to[0] !== '/') {\n            handleConfigError(`scripts[${scriptId}]: \"--to ${to}\" must be a URL path, and start with a \"/\"`);\n        }\n        const { toUrl, fromUrl } = { fromUrl: _[0], toUrl: to };\n        if (config.proxy[toUrl]) {\n            handleConfigError(`scripts[${scriptId}]: Cannot overwrite proxy[${toUrl}].`);\n        }\n        config.proxy[toUrl] = fromUrl;\n        delete config.scripts[scriptId];\n    }\n    return config;\n}\nfunction normalizeScripts(cwd, scripts) {\n    const dependenciesLoc = process.env.NODE_ENV === 'production' ? BUILD_DEPENDENCIES_DIR : DEV_DEPENDENCIES_DIR;\n    const processedScripts = [];\n    if (Object.keys(scripts).filter((k) => k.startsWith('bundle:')).length > 1) {\n        handleConfigError(`scripts can only contain 1 script of type \"bundle:\".`);\n    }\n    for (const scriptId of Object.keys(scripts)) {\n        if (scriptId.includes('::watch')) {\n            continue;\n        }\n        const [scriptType, scriptMatch] = scriptId.split(':');\n        if (!SCRIPT_TYPES_WEIGHTED[scriptType]) {\n            handleConfigError(`scripts[${scriptId}]: \"${scriptType}\" is not a known script type.`);\n        }\n        const cmd = scripts[scriptId];\n        const newScriptConfig = {\n            id: scriptId,\n            type: scriptType,\n            match: scriptMatch.split(','),\n            cmd,\n            watch: scripts[`${scriptId}::watch`],\n        };\n        if (newScriptConfig.watch) {\n            newScriptConfig.watch = newScriptConfig.watch.replace('$1', newScriptConfig.cmd);\n        }\n        if (scriptType === 'mount') {\n            const cmdArr = cmd.split(/\\s+/);\n            if (cmdArr[0] !== 'mount') {\n                handleConfigError(`scripts[${scriptId}] must use the mount command`);\n            }\n            cmdArr.shift();\n            const { to, _ } = yargs(cmdArr);\n            if (_.length !== 1) {\n                handleConfigError(`scripts[${scriptId}] must use the format: \"mount dir [--to /PATH]\"`);\n            }\n            if (to && to[0] !== '/') {\n                handleConfigError(`scripts[${scriptId}]: \"--to ${to}\" must be a URL path, and start with a \"/\"`);\n            }\n            let dirDisk = cmdArr[0];\n            const dirUrl = to || `/${cmdArr[0]}`;\n            // mount:web_modules is a special case script where the fromDisk\n            // arg is harcoded to match the internal dependency dir\n            if (scriptId === 'mount:web_modules') {\n                dirDisk = dependenciesLoc;\n            }\n            newScriptConfig.args = {\n                fromDisk: path.posix.normalize(dirDisk + '/'),\n                toUrl: path.posix.normalize(dirUrl + '/'),\n            };\n        }\n        processedScripts.push(newScriptConfig);\n    }\n    const allBuildMatch = new Set();\n    for (const { type, match } of processedScripts) {\n        if (type !== 'build') {\n            continue;\n        }\n        for (const ext of match) {\n            if (allBuildMatch.has(ext)) {\n                handleConfigError(`Multiple \"scripts\" match the \"${ext}\" file extension.\\nCurrently, only one script per file type is supported.`);\n            }\n            allBuildMatch.add(ext);\n        }\n    }\n    if (!scripts['mount:web_modules']) {\n        processedScripts.push({\n            id: 'mount:web_modules',\n            type: 'mount',\n            match: ['web_modules'],\n            cmd: `mount $WEB_MODULES --to /web_modules`,\n            args: {\n                fromDisk: dependenciesLoc,\n                toUrl: '/web_modules',\n            },\n        });\n    }\n    const defaultBuildMatch = ['js', 'jsx', 'ts', 'tsx'].filter((ext) => !allBuildMatch.has(ext));\n    if (defaultBuildMatch.length > 0) {\n        const defaultBuildWorkerConfig = {\n            id: `build:${defaultBuildMatch.join(',')}`,\n            type: 'build',\n            match: defaultBuildMatch,\n            cmd: '(default) esbuild',\n            plugin: esbuildPlugin(),\n        };\n        processedScripts.push(defaultBuildWorkerConfig);\n    }\n    processedScripts.sort((a, b) => {\n        if (a.type === b.type) {\n            if (a.id === 'mount:web_modules') {\n                return -1;\n            }\n            if (b.id === 'mount:web_modules') {\n                return 1;\n            }\n            return a.id.localeCompare(b.id);\n        }\n        return SCRIPT_TYPES_WEIGHTED[a.type] - SCRIPT_TYPES_WEIGHTED[b.type];\n    });\n    return processedScripts;\n}\nfunction normalizeProxies(proxies) {\n    return Object.entries(proxies).map(([pathPrefix, options]) => {\n        if (typeof options !== 'string') {\n            return [\n                pathPrefix,\n                {\n                    //@ts-ignore - Seems to be a strange 3.9.x bug\n                    on: {},\n                    ...options,\n                },\n            ];\n        }\n        return [\n            pathPrefix,\n            {\n                on: {\n                    proxyReq: (proxyReq, req) => {\n                        const proxyPath = proxyReq.path.split(req.url)[0];\n                        proxyReq.path = proxyPath + req.url.replace(pathPrefix, '');\n                    },\n                },\n                target: options,\n                changeOrigin: true,\n                secure: false,\n            },\n        ];\n    });\n}\n/** resolve --dest relative to cwd, etc. */\nfunction normalizeConfig(config) {\n    const cwd = process.cwd();\n    config.knownEntrypoints = config.install || [];\n    config.installOptions.dest = path.resolve(cwd, config.installOptions.dest);\n    config.devOptions.out = path.resolve(cwd, config.devOptions.out);\n    config.exclude = Array.from(new Set([...ALWAYS_EXCLUDE, ...config.exclude]));\n    if (!config.scripts) {\n        config.exclude.push('**/.*');\n        config.scripts = {\n            'mount:*': 'mount . --to /',\n        };\n    }\n    if (!config.proxy) {\n        config.proxy = {};\n    }\n    const allPlugins = {};\n    // remove leading/trailing slashes\n    config.buildOptions.metaDir = config.buildOptions.metaDir\n        .replace(/^(\\/|\\\\)/g, '') // replace leading slash\n        .replace(/(\\/|\\\\)$/g, ''); // replace trailing slash\n    config.plugins = config.plugins.map((plugin) => {\n        const configPluginPath = Array.isArray(plugin) ? plugin[0] : plugin;\n        const configPluginOptions = (Array.isArray(plugin) && plugin[1]) || {};\n        const configPluginLoc = require.resolve(configPluginPath, { paths: [cwd] });\n        const configPlugin = require(configPluginLoc)(config, configPluginOptions);\n        if ((configPlugin.build ? 1 : 0) +\n            (configPlugin.transform ? 1 : 0) +\n            (configPlugin.bundle ? 1 : 0) >\n            1) {\n            handleConfigError(`plugin[${configPluginLoc}]: A valid plugin can only have one build(), transform(), or bundle() function.`);\n        }\n        allPlugins[configPluginPath] = configPlugin;\n        if (configPlugin.knownEntrypoints) {\n            config.knownEntrypoints.push(...configPlugin.knownEntrypoints);\n        }\n        if (configPlugin.extensionMap) {\n            config.extensionMap = merge([\n                {},\n                config.extensionMap || {},\n                configPlugin.extensionMap,\n            ]);\n        }\n        if (configPlugin.defaultBuildScript &&\n            !config.scripts[configPlugin.defaultBuildScript] &&\n            !Object.values(config.scripts).includes(configPluginPath)) {\n            config.scripts[configPlugin.defaultBuildScript] = configPluginPath;\n        }\n        return configPlugin;\n    });\n    if (config.devOptions.bundle === true && !config.scripts['bundle:*']) {\n        handleConfigError(`--bundle set to true, but no \"bundle:*\" script/plugin was provided.`);\n    }\n    config = handleLegacyProxyScripts(config);\n    config.proxy = normalizeProxies(config.proxy);\n    config.scripts = normalizeScripts(cwd, config.scripts);\n    config.scripts.forEach((script, i) => {\n        if (script.plugin)\n            return;\n        // Ensure plugins are properly registered/configured\n        if (['build', 'bundle'].includes(script.type)) {\n            if (allPlugins[script.cmd]?.[script.type]) {\n                script.plugin = allPlugins[script.cmd];\n            }\n            else if (allPlugins[script.cmd] && !allPlugins[script.cmd][script.type]) {\n                handleConfigError(`scripts[${script.id}]: Plugin \"${script.cmd}\" has no ${script.type} script.`);\n            }\n            else if (script.cmd.startsWith('@') || script.cmd.startsWith('.')) {\n                handleConfigError(`scripts[${script.id}]: Register plugin \"${script.cmd}\" in your Snowpack \"plugins\" config.`);\n            }\n        }\n    });\n    return config;\n}\nfunction handleConfigError(msg) {\n    console.error(`[error]: ${msg}`);\n    process.exit(1);\n}\nfunction handleValidationErrors(filepath, errors) {\n    console.error(chalk.red(`! ${filepath || 'Configuration error'}`));\n    console.error(errors.map((err) => `    - ${err.toString()}`).join('\\n'));\n    console.error(`    See https://www.snowpack.dev/#configuration for more info.`);\n    process.exit(1);\n}\nfunction handleDeprecatedConfigError(mainMsg, ...msgs) {\n    console.error(chalk.red(mainMsg));\n    msgs.forEach(console.error);\n    console.error(`See https://www.snowpack.dev/#configuration for more info.`);\n    process.exit(1);\n}\nfunction validateConfigAgainstV1(rawConfig, cliFlags) {\n    // Moved!\n    if (rawConfig.dedupe || cliFlags.dedupe) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `dedupe` is now `installOptions.rollup.dedupe`.');\n    }\n    if (rawConfig.namedExports) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `rollup.namedExports` is no longer required. See also: installOptions.namedExports');\n    }\n    if (rawConfig.installOptions?.rollup?.namedExports) {\n        delete rawConfig.installOptions.rollup.namedExports;\n        console.error(chalk.yellow('[Snowpack v2.3.0] `rollup.namedExports` is no longer required. See also: installOptions.namedExports'));\n    }\n    if (rawConfig.rollup) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] top-level `rollup` config is now `installOptions.rollup`.');\n    }\n    if (rawConfig.installOptions?.include || cliFlags.include) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.include` is now handled via \"mount\" build scripts!');\n    }\n    if (rawConfig.installOptions?.exclude) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.exclude` is now `exclude`.');\n    }\n    if (Array.isArray(rawConfig.webDependencies)) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] The `webDependencies` array is now `install`.');\n    }\n    if (rawConfig.knownEntrypoints) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `knownEntrypoints` is now `install`.');\n    }\n    if (rawConfig.entrypoints) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `entrypoints` is now `install`.');\n    }\n    if (rawConfig.include) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] All files are now included by default. \"include\" config is safe to remove.', 'Whitelist & include specific folders via \"mount\" build scripts.');\n    }\n    // Replaced!\n    if (rawConfig.source || cliFlags.source) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `source` is now detected automatically, this config is safe to remove.');\n    }\n    if (rawConfig.stat || cliFlags.stat) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `stat` is now the default output, this config is safe to remove.');\n    }\n    if (rawConfig.scripts &&\n        Object.keys(rawConfig.scripts).filter((k) => k.startsWith('lintall')).length > 0) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `scripts[\"lintall:...\"]` has been renamed to scripts[\"run:...\"]');\n    }\n    if (rawConfig.scripts &&\n        Object.keys(rawConfig.scripts).filter((k) => k.startsWith('plugin:`')).length > 0) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `scripts[\"plugin:...\"]` have been renamed to scripts[\"build:...\"].');\n    }\n    // Removed!\n    if (rawConfig.devOptions?.dist) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `devOptions.dist` is no longer required. This config is safe to remove.', `If you'd still like to host your src/ directory at the \"/_dist/*\" URL, create a mount script:',\n      '    {\"scripts\": {\"mount:src\": \"mount src --to /_dist_\"}} `);\n    }\n    if (rawConfig.hash || cliFlags.hash) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.hash` has been replaced by `snowpack build`.');\n    }\n    if (rawConfig.installOptions?.nomodule || cliFlags.nomodule) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.nomodule` has been replaced by `snowpack build`.');\n    }\n    if (rawConfig.installOptions?.nomoduleOutput || cliFlags.nomoduleOutput) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.nomoduleOutput` has been replaced by `snowpack build`.');\n    }\n    if (rawConfig.installOptions?.babel || cliFlags.babel) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.babel` has been replaced by `snowpack build`.');\n    }\n    if (rawConfig.installOptions?.optimize || cliFlags.optimize) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.optimize` has been replaced by `snowpack build`.');\n    }\n    if (rawConfig.installOptions?.strict || cliFlags.strict) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.strict` is no longer supported.');\n    }\n}\nexport function createConfiguration(config) {\n    const { errors: validationErrors } = validate(config, configSchema, {\n        propertyName: CONFIG_NAME,\n        allowUnknownAttributes: false,\n    });\n    if (validationErrors.length > 0) {\n        return [validationErrors, undefined];\n    }\n    const mergedConfig = merge([DEFAULT_CONFIG, config]);\n    return [null, normalizeConfig(mergedConfig)];\n}\nexport function loadAndValidateConfig(flags, pkgManifest) {\n    const explorerSync = cosmiconfigSync(CONFIG_NAME, {\n        // only support these 3 types of config for now\n        searchPlaces: ['package.json', 'snowpack.config.js', 'snowpack.config.json'],\n        // don't support crawling up the folder tree:\n        stopDir: path.dirname(process.cwd()),\n    });\n    let result;\n    // if user specified --config path, load that\n    if (flags.config) {\n        result = explorerSync.load(path.resolve(process.cwd(), flags.config));\n        if (!result) {\n            handleConfigError(`Could not locate Snowpack config at ${flags.config}`);\n        }\n    }\n    // If no config was found above, search for one.\n    result = result || explorerSync.search();\n    // If still no config found, assume none exists and use the default config.\n    if (!result || !result.config || result.isEmpty) {\n        result = { config: { ...DEFAULT_CONFIG } };\n    }\n    // validate against schema; throw helpful user if invalid\n    const config = result.config;\n    validateConfigAgainstV1(config, flags);\n    const cliConfig = expandCliFlags(flags);\n    let extendConfig = {};\n    if (config.extends) {\n        const extendConfigLoc = config.extends.startsWith('.')\n            ? path.resolve(path.dirname(result.filepath), config.extends)\n            : require.resolve(config.extends, { paths: [process.cwd()] });\n        const extendResult = explorerSync.load(extendConfigLoc);\n        if (!extendResult) {\n            handleConfigError(`Could not locate Snowpack config at ${flags.config}`);\n            process.exit(1);\n        }\n        extendConfig = extendResult.config;\n        const extendValidation = validate(extendConfig, configSchema, {\n            allowUnknownAttributes: false,\n            propertyName: CONFIG_NAME,\n        });\n        if (extendValidation.errors && extendValidation.errors.length > 0) {\n            handleValidationErrors(result.filepath, extendValidation.errors);\n            process.exit(1);\n        }\n    }\n    // if valid, apply config over defaults\n    const mergedConfig = merge([\n        pkgManifest.homepage ? { buildOptions: { baseUrl: pkgManifest.homepage } } : {},\n        extendConfig,\n        { webDependencies: pkgManifest.webDependencies },\n        config,\n        cliConfig,\n    ]);\n    for (const webDependencyName of Object.keys(mergedConfig.webDependencies || {})) {\n        if (pkgManifest.dependencies && pkgManifest.dependencies[webDependencyName]) {\n            handleConfigError(`\"${webDependencyName}\" is included in \"webDependencies\". Please remove it from your package.json \"dependencies\" config.`);\n        }\n        if (pkgManifest.devDependencies && pkgManifest.devDependencies[webDependencyName]) {\n            handleConfigError(`\"${webDependencyName}\" is included in \"webDependencies\". Please remove it from your package.json \"devDependencies\" config.`);\n        }\n    }\n    const [validationErrors, configResult] = createConfiguration(mergedConfig);\n    if (validationErrors) {\n        handleValidationErrors(result.filepath, validationErrors);\n        process.exit(1);\n    }\n    return configResult;\n}\n","import chalk from 'chalk';\nimport path from 'path';\nimport yargs from 'yargs-parser';\nimport { command as buildCommand } from './commands/build';\nimport { command as devCommand } from './commands/dev';\nimport { addCommand, rmCommand } from './commands/add-rm';\nimport { command as installCommand } from './commands/install';\nimport { loadAndValidateConfig } from './config.js';\nimport { readLockfile, clearCache } from './util.js';\nexport { createConfiguration } from './config.js';\nconst cwd = process.cwd();\nfunction printHelp() {\n    console.log(`\n${chalk.bold(`snowpack`)} - A faster build system for the modern web.\n\n  Snowpack is best configured via config file.\n  But, most configuration can also be passed via CLI flags.\n  📖 ${chalk.dim('https://www.snowpack.dev/#configuration')}\n\n${chalk.bold('Commands:')}\n  snowpack dev          Develop your app locally.\n  snowpack build        Build your app for production.\n  snowpack install      (Advanced) Install web-ready dependencies.\n\n${chalk.bold('Flags:')}\n  --config [path]       Set the location of your project config file.\n  --help                Show this help message.\n  --version             Show the current version.\n  --reload              Clear Snowpack's local cache (troubleshooting).\n    `.trim());\n}\nexport async function cli(args) {\n    // parse CLI flags\n    const cliFlags = yargs(args, {\n        array: ['install', 'env', 'exclude', 'externalPackage'],\n    });\n    if (cliFlags.help) {\n        printHelp();\n        process.exit(0);\n    }\n    if (cliFlags.version) {\n        console.log(require('../package.json').version);\n        process.exit(0);\n    }\n    if (cliFlags.reload) {\n        console.log(chalk.yellow('! clearing cache...'));\n        await clearCache();\n    }\n    // Load the current package manifest\n    let pkgManifest;\n    try {\n        pkgManifest = require(path.join(cwd, 'package.json'));\n    }\n    catch (err) {\n        console.log(chalk.red('[ERROR] package.json required but no file was found.'));\n        process.exit(1);\n    }\n    const cmd = cliFlags['_'][2];\n    // Set this early -- before config loading -- so that plugins see it.\n    if (cmd === 'build') {\n        process.env.NODE_ENV = process.env.NODE_ENV || 'production';\n    }\n    if (cmd === 'dev') {\n        process.env.NODE_ENV = process.env.NODE_ENV || 'development';\n    }\n    const commandOptions = {\n        cwd,\n        config: loadAndValidateConfig(cliFlags, pkgManifest),\n        lockfile: await readLockfile(cwd),\n        pkgManifest,\n    };\n    if (cmd === 'add') {\n        await addCommand(cliFlags['_'][3], commandOptions);\n        return;\n    }\n    if (cmd === 'rm') {\n        await rmCommand(cliFlags['_'][3], commandOptions);\n        return;\n    }\n    if (cliFlags['_'].length > 3) {\n        console.log(`Unexpected multiple commands`);\n        process.exit(1);\n    }\n    if (cmd === 'build') {\n        await buildCommand(commandOptions);\n        return;\n    }\n    if (cmd === 'dev') {\n        await devCommand(commandOptions);\n        return;\n    }\n    if (cmd === 'install' || !cmd) {\n        await installCommand(commandOptions);\n        return;\n    }\n    console.log(`Unrecognized command: ${cmd}`);\n    process.exit(1);\n}\n"],"names":["parse","require","spliceString","source","withSlice","start","end","slice","scanCodeImportsExports","code","imports","filter","imp","d","importStatement","substring","s","e","importSpecifierMatch","match","transformEsmImports","_code","replaceImport","rewrittenCode","reverse","spec","rewrittenImport","JSON","stringify","PIKA_CDN","GLOBAL_CACHE_DIR","globalCacheDir","RESOURCE_CACHE","path","join","BUILD_CACHE","PROJECT_CACHE_DIR","projectCacheDir","name","DEV_DEPENDENCIES_DIR","BUILD_DEPENDENCIES_DIR","LOCKFILE_HASH_FILE","HAS_CDN_HASH_REGEX","isYarn","cwd","fs","existsSync","readLockfile","lockfileContents","readFileSync","encoding","err","writeLockfile","loc","importMap","sortedImportMap","key","Object","keys","sort","writeFileSync","undefined","fetchCDNResource","resourceUrl","responseType","startsWith","got","headers","throwHttpErrors","isTruthy","item","Boolean","resolveDependencyManifest","dep","depManifest","resolve","paths","result","fullPath","searchPath","sep","replace","indexOfSearch","lastIndexOf","manifestPath","length","manifestStr","MISSING_PLUGIN_SUGGESTIONS","appNames","win32","brave","chrome","darwin","linux","openInBrowser","protocol","port","browser","url","test","process","platform","execa","command","shell","encodeURI","__dirname","stdio","open","app","checkLockfileHash","dir","lockfileLoc","findUp","hashLoc","newLockHash","etag","promises","readFile","oldLockHash","catch","updateLockfileHash","mkdirp","dirname","writeFile","clearCache","Promise","all","cacache","rm","rimraf","sync","findMatchingMountScript","scripts","script","type","find","args","fromDisk","IS_PREACT","checkIsPreact","filePath","contents","endsWith","isDirectoryImport","fileLoc","importedFileOnDisk","stat","statSync","isDirectory","wrapImportMeta","hmr","env","config","buildOptions","includes","metaDir","_cssModuleLoader","wrapCssModuleResponse","ext","hasHmr","injectableSource","exportTokens","load","Error","wrapHtmlResponse","wrapEsmProxyResponse","getFileBuilderForWorker","selectedWorker","messageBus","id","cmd","plugin","build","buildFn","emit","level","msg","message","state","cmdWithFile","stdout","stderr","npmRunPath","extendEnv","input","PUBLIC_ENV_REGEX","generateEnvModule","mode","envObject","MODE","NODE_ENV","esbuildService","esbuildPlugin","startService","isPreact","js","warnings","transform","loader","extname","substr","jsxFactory","jsxFragment","warning","console","error","chalk","bold","text","stopEsbuild","stop","resolveDependency","installSpecifier","packageSemver","lockfile","canRetry","validatePackageName","validForNewPackages","installUrl","installUrlType","warn","cachedResult","get","info","metadata","pinnedUrl","statusCode","body","importUrlPath","pinnedUrlPath","buildStatus","typesUrlPath","typesUrl","put","log","cyan","lookupStatusCode","resolveTargetsFromRemoteCDN","pkgManifest","downloadQueue","PQueue","concurrency","newLockfile","resolutionError","installSemver","entries","webDependencies","add","resolvedUrl","onIdle","getInjectorCode","rollupPluginCss","resolveId","importer","skipSelf","then","resolved","humanReadableName","IS_DEEP_PACKAGE_IMPORT","rollupPluginEntrypointAlias","packageScope","packageName","packageFullName","manifest","_manifest","needsAlias","module","posix","main","rollupPluginCatchUnresolved","isNodeBuiltin","autoDetectExports","red","rollupPluginWrapInstallTargets","isTreeshake","autoDetectPackageExports","installTargets","installTargetsByFile","isAutoDetect","normalizedFileLoc","some","p","options","inputOptions","val","specifier","namespace","split","treeshakeSummary","reduce","summary","default","named","uniqueNamedImports","Array","from","Set","CACHED_FILE_ID_PREFIX","PIKA_CDN_TRIM_LENGTH","rollupPluginDependencyCache","installTypes","allTypesToInstall","cacheKey","response","finalResult","typesTarballUrl","data","toString","writeBundle","tempDir","tmp","mkdir","tarballContents","cachedTarball","tarballResponse","typesUrlParts","pathname","typesPackageName","typesPackageTarLoc","typesPackageLoc","tar","x","file","rollupPluginDependencyStats","cb","outputDir","existingFileCache","statsSummary","direct","common","buildExistingFileCache","bundle","fileName","size","compareDependencies","files","byteLength","gzip","zlib","gzipSync","brotli","brotliCompressSync","delta","generateBundle","directDependencies","commonDependencies","assetOrChunk","raw","Buffer","isBuffer","push","WEB_MODULES_TOKEN","WEB_MODULES_TOKEN_LENGTH","BARE_SPECIFIER_REGEX","ESM_IMPORT_REGEX","ESM_DYNAMIC_IMPORT_REGEX","HAS_NAMED_IMPORTS_REGEX","SPLIT_NAMED_IMPORTS_REGEX","DEFAULT_IMPORT_REGEX","HTML_JS_REGEX","stripJsExtension","createInstallTarget","removeSpecifierQueryString","queryStringIndex","indexOf","getWebModuleSpecifierFromCode","parseWebModuleSpecifier","cleanedSpecifier","webModulesIndex","resolvedSpecifier","resolvedSpecifierWithoutExtension","parseImportStatement","webModuleSpecifier","ss","se","isDynamicImport","hasDefaultImport","hasNamespaceImport","namedImports","map","trim","cleanCodeForParsing","stripComments","allMatches","importRegex","RegExp","exec","dynamicImportRegex","full","parseCodeForInstallTargets","allImports","scanDepList","depList","whitelistItem","glob","hasMagic","nodeModulesLoc","nodePath","nodir","flat","concat","scanImports","exclude","initESModuleLexer","includeFileSets","dirDisk","ignore","absolute","includeFiles","apply","loadedFiles","regex","mime","lookup","dim","relative","target","impA","impB","localeCompare","SIZE_COLUMN_WIDTH","entriesSort","filenameA","filenameB","formatSize","kb","Math","round","floor","color","padEnd","formatDelta","formatFileInfo","filename","stats","isLastFile","lineGlyph","lineName","fileStat","gzipStat","brotliStat","lineStat","lineDelta","formatFiles","strippedFiles","index","printStats","dependencyStats","output","allDirect","allCommon","maxFileNameLength","max","underline","values","ErrorWithHint","constructor","hint","CJS_PACKAGES_TO_AUTO_DETECT","banner","spinner","ora","spinnerHasError","installResults","defaultLogError","stopAndPersist","symbol","fail","defaultLogUpdate","formatInstallResults","green","yellow","getWebDependencyName","getRollupReplaceKeys","acc","resolveWebDependency","isJSFile","depManifestLoc","maybeLoc","italic","foundEntrypoint","checkIsEsModule","filterPackageIsEsModule","externalPackages","install","logError","logUpdate","installOptions","dest","destLoc","externalPackage","alias","installAlias","sourceMap","rollup","userDefinedRollup","treeshake","versions","pnp","allInstallSpecifiers","installEntrypoints","assetEntrypoints","installTargetsMap","autoDetectNamedExports","namedExports","isSinglePackageMode","targetName","targetType","targetLoc","value","forEach","t","setTimeout","isCircularImportFound","external","moduleSideEffects","plugins","rollupPluginReplace","rollupPluginAlias","mod","replacement","rollupPluginNodeResolve","mainFields","extensions","preferBuiltins","dedupe","rollupPluginJson","preferConst","indent","compact","rollupPluginCommonjs","externalEsm","onwarn","outputOptions","format","sourcemap","exports","chunkFileNames","packageBundle","write","_err","errFilePath","failedExtension","suggestion","assetName","assetLoc","copyFileSync","knownEntrypoints","startTime","Date","now","exit","succeed","toFixed","getPort","defaultPort","bestAvailablePort","detectPort","useNextPort","isTTY","rl","readline","createInterface","stdin","question","answer","close","getStateString","workerState","isWatch","isArray","done","watch","WORKER_BASE_STATE","paint","bus","registeredWorkers","buildMode","devMode","startTimeMs","ips","consoleOutput","installOutput","isInstalling","hasBeenCleared","missingWebModule","allWorkerStates","repaint","isServerStarted","ip","dotLength","dots","fmt","stateString","spacer","cmdMsg","cmdStr","pkgName","chalkFn","overallStatus","on","util","emitKeypressEvents","str","addPackage","mjs","jsx","ts","tsx","vue","svelte","mdx","svx","elm","php","md","ejs","njk","scss","sass","less","commandOptions","configSrcFileExtensionMapping","merge","srcFileExtensionMapping","extensionMap","dependencyImportMapLoc","installCommand","EventEmitter","relevantWorkers","allBuildExtensions","dependencyImportMap","workerConfig","isBundled","devOptions","bundleWorker","isBundledHardcoded","buildDirectoryLoc","out","internalFilesBuildLoc","finalDirectoryLoc","relDest","workerPromise","b","stdOutput","errorMatch","mountDirDetails","scriptConfig","dirDest","toUrl","allProxiedFiles","allCssModules","allFiles","dot","allBuildNeededFiles","f","outPath","baseUrl","copyFile","allBuiltFromFiles","webModulesScript","webModulesLoc","fileExtension","fileContents","fileBuilder","extToFind","extToReplace","builtFile","isDev","resources","urlPath","css","cssOutPath","recursive","basename","mountScript","resolvedImport","extName","missingPackageName","deepPackagePathParts","shift","proxiedFileLoc","proxiedCode","proxiedExt","proxiedUrl","proxyCode","proxyFileLoc","srcDirectory","destDirectory","jsFilePaths","EsmHmrEngine","clients","dependencyTree","Map","wss","server","WebSocket","Server","noServer","req","socket","head","handleUpgrade","client","connectClient","registerListener","entry","getEntry","isHmrAccepted","isHmrEnabled","createEntry","sourceUrl","newEntry","dependencies","dependents","needsReplacement","set","createIfNotFound","setEntry","outdatedDependencies","importUrl","addRelationship","delete","removeRelationship","importResult","sourceResult","markEntryForReplacement","broadcastMessage","readyState","OPEN","send","disconnectClient","terminate","disconnectAllClients","HMR_DEV_CODE","DEFAULT_PROXY_ERROR_HANDLER","res","reqUrl","sendError","shouldProxy","pathPrefix","reqPath","decodeURI","getEncodingType","getPackageNameFromSpecifier","sendFile","ETag","weak","contentType","Vary","writeHead","acceptEncoding","method","isCompressible","onError","stream","Readable","bodyStream","pipeline","createGzip","status","getUrlFromFile","mountedDirectories","extensionMapping","dirUrl","fileExt","resolvedDirUrl","getMountedDirectory","currentlyRunningCommand","isHmr","serverStart","inMemoryBuildCache","inMemoryResourceCache","filesBeingDeleted","filesBeingBuilt","isLiveReloadPaused","clear","reinstallDependencies","buildFile","builtFileResult","fileBuilderPromise","_builtFileResult","doesPackageExist","runLintAll","watchCmd","devProxies","proxy","proxyOptions","proxyServer","HttpProxy","createProxyServer","onEventName","eventHandler","readCredentials","cert","credentials","secure","requestHandler","reqUrlHmrParam","originalReqPath","isProxyModule","isCssModule","web","attemptedFileLoads","attemptLoadFile","requestedFile","isFile","requestedFileExt","toLowerCase","responseFileExt","isRoute","getFileFromUrl","fallback","fallbackFile","extMatcher","srcFile","virtualResourceResponse","prefix","wrapResponse","cssResource","node","hmrEngine","hotCachedResponse","wrappedResponse","cachedBuildData","has","originalFileHash","newFileHash","coldCachedResponse","rawImports","resolvedImports","checkFinalBuildResult","checkFinalBuildCss","checkFinalBuildAnyway","equals","finalBuild","createServer","http2","createSecureServer","allowHTTP1","http","isWebSocket","ws","listen","onProcessExit","updateOrBubble","visited","handleHmrUpdate","updateUrl","virtualCssFileUrl","virtualNode","os","networkInterfaces","every","i","family","internal","address","chokidar","onWatchEvent","watcher","ignored","persistent","ignoreInitial","disableGlobbing","symlinkedFileLocs","_","packageManifest","onDepWatchEvent","depWatcher","addCommand","addValue","pkgSemver","json","version","rmCommand","CONFIG_NAME","ALWAYS_EXCLUDE","SCRIPT_TYPES_WEIGHTED","mount","run","DEFAULT_CONFIG","configSchema","properties","extends","items","additionalProperties","oneOf","enum","expandCliFlags","flags","relevantFlags","flag","handleLegacyProxyScripts","scriptId","cmdArr","handleConfigError","to","yargs","fromUrl","normalizeScripts","dependenciesLoc","processedScripts","k","scriptType","scriptMatch","newScriptConfig","normalize","allBuildMatch","defaultBuildMatch","defaultBuildWorkerConfig","a","normalizeProxies","proxies","proxyReq","proxyPath","changeOrigin","normalizeConfig","allPlugins","configPluginPath","configPluginOptions","configPluginLoc","configPlugin","defaultBuildScript","handleValidationErrors","filepath","errors","handleDeprecatedConfigError","mainMsg","msgs","validateConfigAgainstV1","rawConfig","cliFlags","include","entrypoints","dist","hash","nomodule","nomoduleOutput","babel","optimize","strict","createConfiguration","validationErrors","validate","propertyName","allowUnknownAttributes","mergedConfig","loadAndValidateConfig","explorerSync","cosmiconfigSync","searchPlaces","stopDir","search","isEmpty","cliConfig","extendConfig","extendConfigLoc","extendResult","extendValidation","homepage","webDependencyName","devDependencies","configResult","printHelp","cli","array","help","reload","buildCommand","devCommand"],"mappings":"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"}